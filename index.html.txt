<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lịch vạn niên - Văn Trung</title>
    
    <!-- ICON ỨNG DỤNG -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect x=%2210%22 y=%2220%22 width=%2280%22 height=%2270%22 rx=%2215%22 fill=%22white%22 stroke=%22%23DC2626%22 stroke-width=%225%22/><path d=%22M10 35h80%22 stroke=%22%23DC2626%22 stroke-width=%225%22/><rect x=%2225%22 y=%2210%22 width=%2210%22 height=%2225%22 rx=%225%22 fill=%22%23DC2626%22/><rect x=%2265%22 y=%2210%22 width=%2210%22 height=%2225%22 rx=%225%22 fill=%22%23DC2626%22/><text x=%2250%22 y=%2275%22 font-size=%2240%22 text-anchor=%22middle%22 fill=%22%23DC2626%22 font-family=%22sans-serif%22 font-weight=%22bold%22>31</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect x=%2210%22 y=%2220%22 width=%2280%22 height=%2270%22 rx=%2215%22 fill=%22white%22 stroke=%22%23DC2626%22 stroke-width=%225%22/><path d=%22M10 35h80%22 stroke=%22%23DC2626%22 stroke-width=%225%22/><rect x=%2225%22 y=%2210%22 width=%2210%22 height=%2225%22 rx=%225%22 fill=%22%23DC2626%22/><rect x=%2265%22 y=%2210%22 width=%2210%22 height=%2225%22 rx=%225%22 fill=%22%23DC2626%22/><text x=%2250%22 y=%2275%22 font-size=%2240%22 text-anchor=%22middle%22 fill=%22%23DC2626%22 font-family=%22sans-serif%22 font-weight=%22bold%22>31</text></svg>">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.294.0",
        "firebase/app": "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js",
        "firebase/auth": "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js",
        "firebase/firestore": "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"
      }
    }
    </script>

    <style>
        body { background-color: #f3f4f6; transition: background-color 0.3s, color 0.3s; overflow-x: hidden; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* 3D Animations */
        .perspective-container { perspective: 1000px; }
        .anim-next { animation: rotateInRight 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; }
        .anim-prev { animation: rotateInLeft 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; }
        @keyframes rotateInRight { from { transform: translateX(100%) rotateY(-90deg); opacity: 0; } to { transform: translateX(0) rotateY(0); opacity: 1; } }
        @keyframes rotateInLeft { from { transform: translateX(-100%) rotateY(90deg); opacity: 0; } to { transform: translateX(0) rotateY(0); opacity: 1; } }
        .fade-in { animation: fadeIn 0.2s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Calendar, CheckSquare, StickyNote, Plus, Trash2, LogOut, 
            ChevronLeft, ChevronRight, Save, X, User, Settings, AlertCircle, 
            Clock, Bell, Palette, ArrowUp, ArrowDown, WifiOff, 
            Sun, Cloud, CloudRain, BookOpen, CalendarDays, Search, MapPin, 
            MoreVertical, Table
        } from 'lucide-react';
        import { initializeApp } from 'firebase/app';
        import { 
            getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, 
            onAuthStateChanged, signInWithCustomToken, signOut
        } from 'firebase/auth';
        import { 
            getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, 
            onSnapshot, query, serverTimestamp, Timestamp, orderBy, setDoc, getDoc
        } from 'firebase/firestore';

        // --- CẤU HÌNH ---
        const MANUAL_CONFIG = {
            apiKey: "AIzaSyBEgbs4brFEVbBhf7KaEhw8FekAJTUBFZ0",
            authDomain: "lich-van-trung.firebaseapp.com",
            projectId: "lich-van-trung",
            storageBucket: "lich-van-trung.firebasestorage.app",
            messagingSenderId: "527946274728",
            appId: "1:527946274728:web:d74503548b1b799c0caf9d",
            measurementId: "G-05K489C9XT"
        };

        const STORAGE_KEY_CONFIG = 'user_firebase_config';
        const NOTE_COLORS = ['#FEFCE8', '#DBEAFE', '#DCFCE7', '#FCE7F3', '#F3E8FF', '#FFFFFF', '#FFEDD5', '#E0F2FE', '#D1FAE5', '#FAE8FF', '#EDE9FE', '#F5F5F4'];
        
        const BACKGROUNDS = [
            "https://images.unsplash.com/photo-1501854140884-074cf2b21d25?q=80&w=800&auto=format&fit=crop", 
            "https://images.unsplash.com/photo-1441974231531-c6227db76b6e?q=80&w=800&auto=format&fit=crop", 
            "https://images.unsplash.com/photo-1518020382113-a7e8fc38eac9?q=80&w=800&auto=format&fit=crop", 
            "https://images.unsplash.com/photo-1472214103451-9374bd1c798e?q=80&w=800&auto=format&fit=crop", 
            "https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?q=80&w=800&auto=format&fit=crop", 
            "https://images.unsplash.com/photo-1514888286974-6c03e2ca1dba?q=80&w=800&auto=format&fit=crop", 
            "https://images.unsplash.com/photo-1469474968028-56623f02e42e?q=80&w=800&auto=format&fit=crop", 
            "https://images.unsplash.com/photo-1507525428034-b723cf961d3e?q=80&w=800&auto=format&fit=crop"
        ];

        // --- DANH SÁCH KINH PHÁP CÚ SẮP XẾP LẠI ĐÚNG THỨ TỰ ---
        const DEFAULT_VERSES = [
            // PHẦN 1
            "Buông xuống đi, hãy buông xuống đi!\nChớ giữ làm chi, có ích gì.\nThở ra chẳng lại, còn chi nữa?\nVạn pháp vô thường, buông xuống đi!",
            "Buông xuống đi, hãy buông xuống đi!\nChớ giữ làm chi, có ích gì?\nÔm vào đau khổ vô cùng tận,\nBuông xuống ngay liền vạn khổ đi!",
            "Buông xuống đi, hãy buông xuống đi!\nChấp giữ thân tâm có ích gì?\nThở ra chẳng lại, còn chi nữa?\nThân tâm vô thường, buông xuống đi!",
            "Buông xuống đi, hãy buông xuống đi!\nTâm hồn thanh thản, chẳng sầu bi.\nCuộc đời ngắn ngủi trong chớp mắt,\nCòn có vui gì, chẳng bỏ đi?",
            "Buông xuống đi, hãy buông xuống đi!\nChớ diệt ý thức, có ích gì?\nÝ làm chủ, dẫn đầu các pháp,\nLợi ích vô cùng, sao bỏ đi?",
            "Tác ý đi, hãy tác ý đi!\nBất động, thanh thản, chẳng sầu bi.\nTác ý đi, còn lo chi nữa?\nGiải thoát đây rồi, tác ý đi!",
            "Buông xuống đi, hãy buông xuống đi!\nTrò đời như mộng, có còn chi?\nTứ đại trả về cho tứ đại,\nThanh thản, an nhàn lúc phân ly.",
            "Buông xuống đi, hãy buông xuống đi!\nBất động, thanh thản, chẳng sầu bi.\nBuông xuống đi, còn lo chi nữa?\nGiải thoát đây rồi, buông xuống đi!",
            "Việc làm của bản thân ta\nDo tâm, do ý tạo ra, dẫn đầu\nNói năng, hành động trước sau\nÝ mà ô nhiễm: khổ đau theo kề\nTựa như là cái bánh xe\nTheo chân con vật kéo lê trên đường.",
            "Việc làm của bản thân ta\nDo tâm, do ý tạo ra, dẫn đầu\nNói năng, hành động trước sau\nÝ mà thanh tịnh: dạt dào niềm vui\nVà bao hạnh phúc trên đời\nTheo ta như bóng khắp nơi theo hình.",
            "Ai ôm hận bị người hãm hại\n“Nó đánh tôi và chửi mắng tôi”\n“Thắng tôi, cướp đoạt của tôi”\nNhớ hoài bất hạnh, khó nguôi hận thù.",
            "Ai bỏ được hận thù bị hại:\n“Nó đánh tôi và chửi mắng tôi”\n“Thắng tôi, cướp đoạt của tôi”\nHận thù tan biến, nguôi ngoai cõi lòng.",
            "Trả thù hận bằng tâm oán giận\nMuôn kiếp dài khó đặng thành công\nTừ bi chuyển hóa thù chung\nĐây là định luật công bằng xưa nay.",
            "Trong kiếp sống ai ngờ cái chết\nRình rập ta chẳng sót mảy may\nNgười nào giác ngộ điều này\nHơn thua, tranh chấp... dứt ngay tức thì.",
            "Ai đắm nhiễm năm điều dục lạc\nChẳng giữ tâm, làm chủ giác quan\nUống ăn thái quá hại thân\nTánh hay lười biếng, nhọc nhằn qua loa.",
            "Người như thế bị ma đánh bại\nCũng giống như gió thổi ngã cây.\nKhổ đau, bất lực nào hay\nĐều do buông thả, đắm say sắc trần.",
            "Không nhiễm đắm, quán thân nhơ uế\nGiữ gìn tâm, làm chủ giác quan\nUống ăn tiết độ, siêng năng\nVững vàng như núi trước ngàn bão giông.",
            "Dù khoát áo cà-sa đĩnh đạc\nMà tâm còn uế trược tham, sân\nSống không chân thật, buông lung\nLàm sao xứng hạnh sa-môn sáng ngời?",
            "Ai giải phóng tham, sân, trược uế\nSống thanh cao, giữ giới nghiêm minh\nChánh chân, làm chủ được mình\nNgười tu như thế thật tình đáng khen.",
            "“Không chân thật lại cho chân thật\nChân thật thì lầm tưởng dối gian”\nTà tư, tà hạnh làm nhân\nDo vậy khó đạt chánh chân trong đời.",
            "“Cái chân thật thì cho chân thật\nKhông chân thì khẳng định không chân”\nChánh tư, chánh hạnh làm nhân\nNhờ vậy đạt được chánh chân trong đời.",
            "Nhà vụng lợp có nhiều lỗ dột\nMột trận mưa làm ướt tả tơi.\nNgười không tu tập, mải chơi\nDục tham xâm nhập, cả đời khổ đau.",
            "Nhà lợp khéo, chỗ nào cũng kín\nNhiều mưa to chẳng ảnh hưởng chi.\nVới người tinh tấn tu trì\nDục tham dứt sạch, có gì phải lo?",
            "Kiếp này khổ, kiếp sau càng khổ\nKẻ ác gian chịu khổ hai đời\nQuả sầu đeo bám khôn nguôi,\nNhớ ác, day dứt khó rời khỏi ta.",
            "Kiếp này sướng, kiếp sau càng sướng\nNgười đức cao được hưởng phước vui\nThiện nhân trổ quả còn hoài\nNhớ thiện, an lạc tràn đầy trong tâm.",
            "Kiếp này khổ, kiếp sau than khổ\nGieo ác nhân phải khổ hai đời\nLương tâm dằn vặt tơi bời\nRơi vào cõi dữ, than hoài chẳng xong.",
            "Kiếp này sướng, kiếp sau càng sướng\nLàm phúc thì sung sướng hai đời\nPhúc do làm thiện tuyệt vời\nSanh về cõi thiện, thảnh thơi lâu dài.",
            "Làu thông cả kho kinh sâu sắc\nKhông thực hành, phóng dật ích chi?\nKhác gì như kẻ làm thuê\nChăn bò cho chủ, có gì của ta?",
            "Người nói ít nhưng hành miên mật\nBỏ tham, sân; tỉnh giác, thong dong\nHai đời dính mắc không còn\nNgười này xứng hạnh sa-môn sáng ngời.",
            "Không phóng dật là con đường sống\nKẻ buông lung làm hỏng cuộc đời.\nKhông còn phóng dật, sáng ngời\nBuông lung như kẻ chết rồi, ích chi.",
            "Sống bất tử với đường tỉnh thức\nThói buông lung là vực tử sanh.\nĐịnh thiền, giới hạnh, tinh cần\nUng dung đạo giác, an nhàn thân tâm.",
            "Người có trí siêng tu thiền định\nLuôn tinh cần thức tỉnh ngày đêm\nNiết-bàn vô thượng xứng tên\nKhổ đau, trói buộc không còn đeo mang.",
            "Luôn tinh tấn, tự điều, chính niệm\nNương pháp màu, đức hạnh sáng trong,\nGiữ mình, dứt bỏ buông lung\nTiếng lành, phước tốt gia tăng mỗi ngày.",
            "Luôn nỗ lực vượt qua phóng dật\nTự điều thân, làm chủ giác quan\nTrí nhân như đảo vững vàng\nBão giông không thể ngập tràn được đâu.",
            "Kẻ thiếu trí đam mê phóng dật\nBám nghiệp duyên, rồi gặt quả sầu\nTrí nhân tinh tấn trước sau\nNhư gìn của báu làm giàu bản thân.",
            "Cảnh hưởng thụ không thèm màng tới\nDục lạc đời chẳng luyến ái tham.\nSiêng tu thiền định, chánh tâm,\nNiềm vui sâu lắng đạt thành khó chi.",
            "Người có trí dẹp tan phóng dật\nTrên lầu cao tuệ giác nhìn trông\nKhông sầu khổ, hết buồn vương\nThương người ngu dưới kiếp hồng trần kia.",
            "Sống tinh tấn giữa người phóng đãng\nTỉnh thức luôn bên cạnh kẻ say\nTrí nhân như ngựa khéo nài\nBỏ xa ngựa yếu cả bầy sau lưng.",
            "Như Đế Thích do tu tinh tấn\nKhi tái sanh làm chủ cõi thiên\nKhông còn phóng dật được khen.\nĐời hay chỉ trích kẻ ghiền buông lung.",
            "Tâm luôn thích niềm vui tinh tấn\nSợ buông lung phá hạnh thanh cao\nTu theo pháp Phật nhiệm mầu\nĐốt tiêu trói buộc, sầu đau bao đời.",
            "Tâm luôn thích niềm vui tinh tấn\nSợ buông lung phá hạnh thanh cao\nTu theo pháp Phật nhiệm mầu\nNiết-bàn sẽ chứng, khổ sầu lánh xa.",
            "Tâm dao động, sầu lo, sợ hãi\nKhó giữ gìn, vùng vẫy theo duyên.\nTrí nhân làm thẳng tâm này\nNhư người thợ khéo uốn tên thẳng hàng.",
            "Như tôm cá vất ngoài thủy giới\nLuôn vẫy vùng hướng tới nước nguồn\nTâm tu vẫy mạnh thoát trần\nQuyết lòng dẹp sạch Ma quân não phiền.",
            "Tâm phàm tục chuyền cành như khỉ\nTheo thú vui thành thị, xóm làng.\nLành thay, làm chủ được tâm\nGiữ tâm định tĩnh, bình an lâu dài.",
            "Tâm vi tế, khó nhìn, khó thấy\nTheo dục tham, thoải mái quay cuồng\nTrí nhân làm chủ được tâm\nNiềm vui nội tại phủ trùm khắp nơi.",
            "Đâu cần phải chạy xa, sống ẩn\nVào hang sâu, hóa hiện không thân.\nChi bằng điều phục được tâm\nVượt qua trói buộc của ngàn Ma quân.",
            "Đối với kẻ tâm không an trụ\nPháp nhiệm mầu khó tỏ nguồn khơi\nNiềm tin rúng động ,chơi vơi\nCòn nguồn trí tuệ rạng ngời khó thông.",
            "Khi tâm thoát dục tham, vướng mắc\nBuông hận thù, ganh ghét, hờn ghen\nVượt trên thiện ác nhị nguyên\nXứng hàng tỉnh thức, không còn sầu lo.",
            "Thân năm uẩn như sành dễ bể\nGiữ gìn tâm như thể thành trì\nVung gươm trí tuệ diệt si\nThắng Ma quân xấu, chớ vì vinh quang.",
            "Thân vô thường, chẳng bao lâu nữa\nNằm vô tri trong cỗ quan tài\nKhi tâm thoát khỏi thân này\nThân như khúc gỗ chẳng xài vào đâu.",
            "Người ác độc diệt trừ đối thủ\nKẻ oan gia trả đũa oan gia\nKhông bằng tâm ác hại ta\nTrầm luân muôn kiếp, đường tà lún sâu.",
            "Cha mẹ muốn cho con hưởng phước\nThương cỡ nào, chẳng được dài lâu\nTâm lành, nhân tốt gieo sâu\nTự mình tạo dựng, quả mau lớn dần.",
            "Ai chinh phục địa cầu, thiên giới\nVượt lên trên cả cõi Diêm-ma\nSao bằng ngộ pháp Phật-đà\nNhư người khéo kết tràng hoa đẹp màu.",
            "Bậc hữu học vượt qua trời đất\nVượt lên trên cả cõi Diêm-ma\nLại thông chánh pháp Phật-đà\nNhư người khéo kết tràng hoa đẹp màu.",
            "Khi tỏ ngộ thân như bọt nước\nẢo ảnh như điện chớp trên không\nBẻ tan tên của Ma quân\nVượt tầm thần chết hàng ngàn dặm xa.",
            // PHẦN 2
            "Dùng vũ khí, gậy dao đánh đập\nHành hạ người, trù dập tơi bời\nQuả sầu mười loại sau đây:\nMột là đau nhức đêm ngày rên la;",
            "Hai, tai biến; ba là thương tật;\nBốn, độn căn, ngu ngốc, hay quên;\nNăm thường lận đận luật quan;\nSáu vương trọng tội bị oan, hiểu lầm.",
            "Bảy, thân quyến, họ hàng ly tán\nTám, chẳng may tài sản tiêu tan\nChín là hỏa hoạn, nghèo nàn\nMười sau khi chết đọa làm súc sinh.",
            "Dù lõa thể, ngồi lì, tuyệt thực;\nKhông gội đầu, bện tóc rối tung…\nĐừng hòng chuyển hóa tâm hồn\nNếu tâm nghi hoặc vẫn còn y nguyên.",
            "Sống trang sức bằng nguồn an tịnh\nĐiều phục tâm, giới hạnh, kiên trì\nThương người, mến vật, từ bi\nSa-môn, phạm chí sánh vì trời cao.",
            "Trong trời đất hiếm người chính niệm,\nBiết giữ mình, hổ thẹn, lương tâm\nTránh lời chỉ trích, chửi thầm\nCũng như ngựa giỏi chẳng cần phạt roi.",
            "Như ngựa quý chẳng cần roi chạm\nSống nhiệt tâm, dũng cảm, chuyên cần\nVững tin, giới đức, thiền hành\nChọn tìm giáo pháp, thấm nhuần lý chân.",
            "Gìn chính niệm, cùng Minh Hạnh túc\nNêu quyết tâm tam độc loại trừ,\nKhổ đau kết thúc, thản thư\nNgười này xứng bậc chân tu trên đời.",
            "Như thủy lợi làm kênh dẫn nước\nKẻ làm tên nắn vuốt cung tên\nThợ cây bào ván hai bên\nNgười khôn làm chủ bản thân đêm ngày.",
            "Cười sao được, sướng vui sao nổi\nKhi lửa tham cháy rụi thế gian\nTối tăm giăng phủ trời đêm\nSao không nỗ lực tìm đèn sáng soi?",
            "Thân bề ngoài, đẹp đầy nhựa sống\nỞ bên trong, một đống vết thương\nGây sầu, sao lại vấn vương?\nThân là giả tạm, vô thường, mong manh.",
            "Thân mấy chốc đã già, tàn tạ\nNơi chứa đầy bệnh khổ, hôi tanh\nVô thường tổ hợp mong manh\nChết là kết thúc, tái sanh hồng trần.",
            "Thân thể này màu bồ câu trắng\nNhư trái bầu, thu đến vứt đi.\nChết rồi thi thể gớm ghê\nCó gì vui thích, mải mê thân này?",
            "Ôi, thân thể như thành trì cổ\nDựng bằng xương, máu đỏ, thịt, gân\nChứa già, chết, bệnh từng phần\nCống cao, lừa dối; dáng duyên nỗi gì!",
            "Xe vua đẹp có ngày cũng cũ\nThân thể rồi ủ rũ, tàn phai\nPháp lành trẻ mãi, còn hoài\nHãy nên khắc cốt những lời thánh nhân.",
            "Trẻ ít học, già không hiểu biết\nChẳng khác gì bò đực lớn đầu\nThân to, cơ bắp, khỏe, mau\nNhưng không trí tuệ, khác nào bóng đêm?",
            "Lang thang suốt luân hồi bao kiếp\nQuyết đi tìm “ông xếp” xây nhà\nTìm hoài, tìm mãi, không ra\nTái sanh, khổ lụy, đọa sa ba đường.",
            "Nay ta cấm ngươi không xây nữa\nPhá cột kèo, ván cửa, rui mè…\nNay ta đã chứng niết-bàn\nÁi tham, chấp thủ tiêu tan hết rồi.",
            "Lúc còn trẻ chẳng màng đạo đức\nKhông học nghề, tự lập lo thân\nĐến già gặp phải khó khăn\nNhư cò ủ rũ, không còn cá tôm.",
            "Có người trẻ chẳng rèn đức hạnh\nKhông luyện nghề, không lãnh tiền lương\nKhi già, buồn tủi, sầu vương\nNhớ về dĩ vãng, thở than vắn dài.",
            "Người đánh giá bản thân là quý\nPhải chính tâm bảo vệ lấy mình\nNgày đêm người trí giữ gìn\nLuôn trong tỉnh thức, tịnh minh cõi lòng.",
            "Người trí tuệ bản thân vững chải\nTự chủ mình, hoàn thiện, chánh chân\nXong rồi, giáo hóa tha nhân\nSống trong gương mẫu, thế gian nể vì.",
            "Người gương mẫu thực hành hoàn tất\nMới đem ra giáo dục thế nhân\nTự mình làm chủ thân tâm\nSoi gương nhân cách, hạnh lành truyền trao.",
            "Người sáng suốt tự nương mình vững\nKhông tìm cầu, dựa dẫm vào ai\nLành thay, điều phục tâm này\nBiết tự điều phục, không hai trên đời.",
            "Các điều ác do mình tạo tác\nÁc do tâm, ai khác ngoài ta\nÁc nhân nghiền nát người tà\nNhư kim cương cứng nghiền qua đá thường.",
            "Như tầm gửi bám cây Phật pháp\nNgười buông lung giới đức chẳng gìn\nHạnh tà chuốc họa vào thân,\nKẻ thù sung sướng thấy mình tiêu tan.",
            "Làm điều ác không cần trình độ\nHãm hại ta đau khổ dễ hơn\nKhó thay, làm thiện chánh chơn\nMình người lợi lạc, bình an cõi đời.",
            "Kẻ ác kiến ngu si, phỉ báng\nGiáo pháp hàng La-hán nhiệm mầu\nHại mình như ngọn trúc lau\nNgay khi trổ quả nhuốm màu diệt vong.",
            "Các điều ác do mình tự tạo\nRồi vướng vào khổ não, họa tai.\nĐiều lành ta tạo hôm nay\nQuả an vui đến sớm mai là thường.",
            "Nên hiểu rõ sạch trong, nhơ uế\nHành động do gốc rễ từ tâm\nCậy nhờ tha lực khó thành\nĐỗ lỗi “tại, bởi” sao đành, không nên.",
            "Dù phụng sự, vị tha thiết thực\nXin chớ quên thực tập lợi mình\nChuyên tâm học pháp cao minh\nHướng về giải thoát, đạt thành mới thôi.",
            "Người sáng suốt chớ ôm tà kiến\nSống buông lung, ti tiện qua ngày.\nNghiệp tà vạy, chớ kéo dài\nĐược vầy, sinh tử luân hồi sớm ra.",
            "Luôn tinh tấn không mê lạc thú\nHạnh thanh cao, tu sĩ thường ghi\nTrang nghiêm giới đức, hành trì\nHai đời hưởng phúc chỉ vì tu tâm.",
            "Hãy quán tưởng trong đời trần tục\nMọi thứ như bọt nước, huyễn vong.\nĐến khi ngộ lẽ vô thường\nTử thần không thể lần đường chân nhân.",
            "Cõi hồng trần đẹp tuồng ảo mộng\nNhư xe vua hoành tráng gấm thêu\nKẻ ngu tham đắm, chắt chiêu\nNgười khôn tỉnh thức, chẳng yêu nhiễm đời.",
            "Dù quá khứ buông lung, dục lạc\nNhưng về sau tỉnh thức, chuyển tâm\nLàm lành, tỏa sáng trần gian\nNhư trăng rằm chiếu, không còn mây che.",
            "Dù ngày trước gây bao tội lỗi\nNhưng hôm nay sám hối, hồi tâm\nLàm lành, tỏa sáng trần gian\nNhư trăng rằm chiếu, không còn mây che.",
            "Kẻ mù tối, thế gian đầy dẫy\nNgười sáng trong có mấy trên đời!\nNhư chim khôn chẳng vướng mồi\nNgười tu đạo đức an vui cõi trời.",
            "Như trời thẳm, thiên nga uốn lượn\nCó thần thông ẩn hiện không gian\nTrí nhân thoát chốn hồng trần\nVượt qua ma chướng, vững vàng đường tu.",
            "Với những kẻ chẳng tôn trọng Pháp\nDùng vọng ngôn lừa lọc, rêu rao\nGhét thiện, bác bỏ đời sau...\nLún sâu đường ác, ngày nào vượt ra!",
            "Kẻ keo kiệt không sanh thiên giới\nNgười dại ngu chẳng đoái tình thương\nNgười hiền thích sống thiện lương\nĐời sau hưởng phúc khác thường thế nhân.",
            "Chứng sơ quả thánh nhân rạng rỡ\nHơn cõi trời Thiên chủ uy quyền\nHơn Trời trong chốn càn khôn\nKhó tìm trong cõi bụi hồng người hơn.",
            "Phật chiến thắng hoàn toàn cõi trược\nTham ái trừ, tuệ giác sâu ngần\nKhông lưu dấu vết trần gian\nĐố ai vẽ được bước chân vượt đời.",
            "Bậc giải thoát lưới tham, ái dục\nHết tái sanh, tuệ giác sâu ngần\nKhông lưu dấu vết trần gian\nĐố ai vẽ được bước chân vượt đời.",
            "Người có trí thiền hành, tinh tấn\nTìm niềm vui trong hạnh viễn ly\nĐêm ngày tỉnh thức luôn khi\nTrời người kính trọng, sánh vì trăng sao.",
            "Thật hạnh phúc, làm người nhân đức\nQuả khó thay, sống thật tịnh thanh\nKhó thay, nghe pháp, thực hành\nKhó thay, gặp Phật chứng thành quả cao.",
            "Mọi hoàn cảnh không làm bất thiện\nDù khó khăn, phát triển nhân lành\nLuyện tâm, rèn ý tịnh thanh\nLà lời Phật dạy đành rành xưa nay.",
            "Tu nhẫn nhục: Khổ hành đáng quý\nĐạt niết-bàn: Quả vị tối cao\nChúng sinh: Chẳng hại tơ hào\nHạnh sa-môn ấy cao sâu khó bàn.",
            "Không phỉ báng, không làm thương tổn\nLàm chủ mình, giới bổn vẹn toàn\nĐiều hòa ăn uống, định thiền\nSống đời an tịnh, không phiền một ai.",
            "Dù mưa rãi bạc vàng chưa thỏa\nLòng dục tham không đáy xưa nay\nTrí nhân hiểu rõ điều này\nKhổ nhiều, vui ít, không sai bao giờ.",
            "Ngộ lẽ ấy, người tu học Phật\nChẳng đam mê dục lạc người, trời\nQuyết lòng chuyển hóa, thảnh thơi\nKhông còn tham ái, rạng ngời nhân gian.",
            "Trong nguy khổ, người tìm nương tựa\nHoặc thần linh, rừng rú, non cao,\nMiếu, đình, cây, vật, hang sâu,\nVái van, hiến tế, mong sao an lành.",
            "Nương tựa ấy hoàn toàn vô bổ\nTìm loanh quanh, nhiều chỗ bất an\nKhổ đau còn đó, chưa tan\nChỉ do mê tín, chẳng thành tựu chi.",
            "Người có phước, tìm về Tam bảo\nPhật, Pháp, Tăng quý báu khó hơn\nKhó khăn, bất hạnh tựa nương\nDùng Bốn chân lý làm phương thoát nàn.",
            "Thấy đau khổ, nguyên nhân gây khổ\nThấy Niết-bàn, thánh lộ tám ngành\nĐưa người đến chốn bình an\nKhông còn bất hạnh, trần gian muộn phiền.",
            "Nương tựa ấy tạo nên quả phước\nNguồn tâm linh, thể đạt an vui\nNgười khôn nương tựa đời đời\nVẫy chào đau khổ, thảnh thơi cuộc đời.",
            "Bậc trí tuệ vun bồi giới đức\nTìm khắp nơi hiếm được một người\nChỗ nào có bậc trí tài\nXóm làng hạnh phúc, cuộc đời bình an.",
            "Ôi hạnh phúc, Như Lai thị hiện\nPháp cao siêu lăn chuyển khắp nơi\nTăng đoàn hòa hợp đạo đời\nBốn hàng đệ tử cùng vui tu hành.",
            "Biết lễ kính những người đáng kính\nPhật, thánh hiền đức hạnh thanh cao\nNhững người chướng ngại sạch làu\nNão phiền dứt sạch, khổ đau giã từ.",
            "Nhờ cung kính chân tu quảng đại\nBậc tịnh an, tự tại thấy nghe,\nKhông còn sợ hãi, sầu, mê,\nPhước lành mỹ mãn đề huề bên ta.",
            "Phúc thay sống giữa người thù hận\nLòng thảnh thơi, chẳng giận hờn ai\nLành thay, sống giữa chua cay\nKhông hề oán hận, nguôi ngoai cõi lòng.",
            "Phúc thay sống giữa người đau bệnh\nChẳng hề chi, khỏe mạnh tấm thân,\nLành thay, sống giữa nguy nan\nBình an, vô sự, an toàn trước sau.",
            "Phúc thay sống giữa người khát dục\nLòng dửng dưng, gạn đục khơi trong.\nLành thay, sống giữa vô thường\nLòng không ham muốn, không vương khổ sầu.",
            "Phúc thay sống giữa người chấp hữu\nGìn vô tham, vô ngã, không sầu.\nCõi lòng an lạc vô cầu\nVui như thiên giới đứng đầu Quan Âm.",
            "Người chiến thắng thường gây thù oán\nKẻ bại thua uất hận khổ đau.\nVui thay, hòa hợp trước sau,\nBỏ qua thắng bại, dâng trào niềm vui.",
            "Trong các lửa, dục tham số một\nCòn tâm sân vượt trội quân ma,\nKhổ nào sánh kịp chấp “ta”\nNiết-bàn tối thượng thật là lạc an.",
            "Cơn đói khát chính là bệnh dữ\nChấp cái ta, bệnh khổ nhiều hơn.\nVượt qua bỉ thử, ngã nhơn\nNiết-bàn chứng đắc, cát tường an vui.",
            "Có sức khỏe còn hơn tặng phẩm\nBiết đủ là tài sản tối cao\nChân tình là bạn tâm giao\nNiết-bàn số một, phúc nào sánh hơn!",
            "Người nếm vị thanh cao ẩn dật\nVui niết-bàn, an lạc khó hơn.\nNhiễm ô, sợ hãi đâu còn\nThấm nhuần pháp hỷ, tâm không vướng gì.",
            "Thật may mắn, thánh nhân gặp mặt\nĐược gần bên hạnh phúc nào hơn!\nPhúc thay, chẳng gặp ngu nhân\nCàng xa khỏi họ, càng an lành nhiều.",
            "Cùng chung sống với người ngu tối\nKhổ khác gì sống với kẻ thù.\nSống chung người trí vô ưu\nNhư cùng thân quyến chẳng lo sợ gì.",
            "Với những bậc tinh thông, sáng suốt\nNgười giữ gìn, giới đức, thánh nhân\nQuyết lòng gần gũi, kết thân\nNhư trăng soi sáng con đường đang đi.",
            "Cố đeo đuổi điều nên xa lánh\nViệc đáng theo lại tránh không làm.\nBỏ mục tiêu, vướng ái tham\nNỡ nào ganh ghét người ham tu hành?!",
            "Chớ gần gũi người thương quá đỗi\nĐừng gần người bực bội, ghét mình\nThương không gặp, khổ muôn phần\nTiếp duyên kẻ ghét ngút ngàn khổ đau.",
            "Hiểu được thế, chớ yêu chớ nhớ\nYêu xa nhau, đau khổ biệt ly\nVẫy chào yêu ghét, sầu bi\nCắt dây trói buộc, còn gì sướng hơn!",
            "Gốc tham ái sanh ra đau khổ\nTạo sầu bi, lo sợ ngã nhân\nAi trừ tham ái khỏi tâm\nXa lìa sợ hãi, không còn sầu bi.",
            "Gốc luyến ái sanh ra đau khổ\nTạo sầu bi, lo sợ ngã nhân\nAi trừ luyến ái khỏi tâm\nXa lìa sợ hãi, không còn sầu bi.",
            "Gốc hỷ ái sanh ra đau khổ\nTạo sầu bi, lo sợ ngã nhân\nAi trừ hỷ ái khỏi tâm\nXa lìa sợ hãi, không còn sầu bi.",
            "Gốc dục ái sanh ra đau khổ\nTạo sầu bi, lo sợ ngã nhân\nAi trừ dục ái khỏi tâm\nXa lìa sợ hãi, không còn sầu bi.",
            "Gốc khát ái sanh ra đau khổ\nTạo sầu bi, lo sợ ngã nhân\nAi trừ khát ái khỏi tâm\nXa lìa sợ hãi, không còn sầu bi.",
            "Người giới đức, tuệ tri đầy đủ\nNương pháp lành, chứng ngộ lý chân\nLàm xong những việc phải làm\nMọi người kính nể mười phân vẹn mười.",
            "Niết-bàn chứng ly ngôn tông chỉ\nQuả tam hiền, tuệ trí viên thông\nLìa dục lạc, tịnh cõi lòng\nBậc chân nhân đó ngược dòng thế gian.",
            "Như lữ khách biệt tăm, xa vắng\nNay trở về lành lặn, bình an\nBạn bè, thân quyến hân hoan\nChúc mừng sum họp, xóm làng chia vui.",
            "Cũng như thế, với người làm thiện\nBao đời qua cho đến đời nay,\nQuả lành chào đón hai tay\nChúc mừng hạnh phúc, khó ai được bằng!",
            "Tu chuyển hóa không còn giận tức\nĐã lìa xa danh sắc, mạn, tham\nKhông còn kiết sử buộc ràng\nNgười “vô sản” ấy xua tan khổ sầu.",
            "Dừng phẫn nộ khi tâm tức giận\nNhư đạp phanh, xe thắng lại ngay.\nXứng danh người lái xe tài.\nCòn những người khác là nài cầm cương.",
            "Dùng “không hận” vượt qua cơn giận\nBố thí nhiều chiến thắng san tham\nNhân từ chinh phục ác gian\nDùng tâm chân thật thắng ngàn ngụy trang.",
            "Dù nghèo khó, thực hành ban tặng\nChuyển hóa tâm, sân hận không còn\nNói lời ái ngữ, thực lòng:\nĐây là điều kiện sanh lên cõi trời.",
            "Người gieo rắc tình thương, bất hại\nKhắp mọi nơi, tự tại thân, tâm\nLìa phiền não, hướng niết-bàn\nKhổ đau kết thúc, bình an giữa đời.",
            "Người tỉnh thức ngày đêm tinh tấn,\nHọc và tu cố gắng song hành\nMột lòng hướng đến niết-bàn\nVượt qua lậu hoặc, dễ dàng thành công.",
            "Người im lặng bị chê không biết\nKẻ phát ngôn mang tiếng lắm lời\nCó ai không bị chê cười?\nThị phi là thói miệng đời xưa nay.",
            "Như quy luật điều này kim cổ\nChẳng ai từng toàn bị chê thôi\nCũng không mãi được khen hoài\nKhen chê là thói miệng đời, bận chi!",
            "“Người có trí sống không tỳ vết\nGiới hạnh và định, tuệ tròn đầy.”\nAi thường thẩm sát vị này\nCông tâm tán thán, nể người chân tu.",
            "Người giữ giới như vàng óng ánh\nMột lòng tu, đức hạnh cao vời\nXứng danh khen ngợi của đời\nPhạm thiên cũng phải ngỏ lời tán dương.",
            "Thân làm chủ thì đừng cáu giận\nPhòng hộ thân sẽ đặng an lành\nCác điều xấu ác chớ làm\nNhững điều đạo đức tinh cần không quên.",
            "Làm chủ miệng thì đừng cáu giận\nPhòng hộ lời sẽ đặng an lành\nKhông lời thô ác, cộc cằn\nNhững lời từ ái tinh cần không quên.",
            "Làm chủ ý thì không cáu giận\nPhòng hộ tâm sẽ đặng an lành\nTâm không tà kiến, dữ dằn\nTư duy chân chánh tinh cần không quên.",
            "Bậc hiền trí điều thân, miệng, ý\nGìn cả ba tỉ mỉ không quên\nThân lành, lời đẹp, ý chơn\nHoàn thành điều phục, không còn bợn nhơ.",
            "Thân thể sẽ tàn như lá úa\nThần chết luôn chầu chực kề bên\nỞ đời, mạng sống vô thường\n“Hành trang” chưa đủ, đường trường mệt hơi.",
            "Hãy xây dựng cho mình hòn đảo\nGấp tinh cần, vì đạo tu hành\nDứt phiền não, ý tịnh thanh\nLên miền đất thánh, tái sanh trời lành.",
            "Nay thân thể tàn suy, sắp hết\nGặp Diêm Vương, thần chết kề bên\nGiữa đường không thể nghỉ chân\n“Hành trang” chưa đủ, dặm đàng mệt hơi.",
            "Hãy xây dựng cho mình hòn đảo\nGấp tinh cần, vì đạo tu hành\nDứt phiền não, ý tịnh thanh\nKhông còn già, chết, tử sanh đèo bồng.",
            "Bậc hiền trí tự mình nỗ lực\nChuyển uế tâm, gạn đục khơi trong\nCũng như thợ giỏi luyện vàng\nKhông còn tạp chất, tinh ròng hoàng kim.",
            "Chất rỉ sét sanh ra từ sắt\nLại ăn mòn thanh sắt dần dần\nÁc nhân gieo nghiệp chẳng lành\nTạo thành quả ác, tự mình vương mang.",
            "Không tụng niệm làm nhơ kinh điển\nKhông quét lau làm bẩn cửa nhà\nBiếng lười nhan sắc mau già\nKẻ buông lung mãi lơ là phòng canh.",
            "Thiếu tiết hạnh tan tành phụ nữ\nKeo kiệt thường thích giữ, không cho\nÁc tà là một vết nhơ\nĐời này, đời tới lờ mờ, khổ đau.",
            "Trong tất cả bẩn nhơ vừa kể\nVô minh là cấu uế đứng đầu\nNgười tu siêng học pháp mầu\nXứng hàng vô nhiễm, vượt cầu tử sinh.",
            "Không hổ thẹn thói này dễ quá\nLỗ mãng như chim quạ cắn lưng\nChê bai, ngã mạn, ngông cuồng\nNhiễm ô, liều lĩnh, trăm đường trái ngang.",
            "Đẹp biết mấy, người thường hổ thẹn\nSống vô tư, khiêm tốn, hài hòa\nBuộc ràng nhất quyết lìa xa\nGiữ tâm sáng suốt, thật thà, tịnh thanh.",
            "Có những kẻ sát sanh, hại vật\nCủa không cho cướp đoạt về mình\nDối gian, nghiện ngập, ngoại tình\nTự đào mộ huyệt, tự chôn cuộc đời.",
            "Chính vì thế người khôn nên biết\nChế ngự tâm thì ác diệt vong\nTham lam tội lỗi cùng đường\nKhổ đau, lận đận, đoạn trường khó ngưng.",
            "Do tâm đạo hoặc lòng hoan hỷ\nMà có người bố thí, cúng dường.\nAi người bất mãn, ganh, hờn\nNgày đêm khó được định tâm an lành.",
            "Ai bỏ được hờn căm, ganh ghét\nBiết vui theo hạnh phúc của người\nNgày đêm tùy hỷ, tươi cười\nĐịnh tâm đạt được giữa đời trái ngang.",
            "Lửa dữ nhất là tham ái nặng\nChấp nào hơn thù hận tái tê\nLưới nào hơn lưới si mê\nSông tình bể dục kéo lê bao người.",
            "Bươi móc lỗi của người quá dễ\nNhư quạt quay, thổi trấu ra ngoài\nLỗi mình che giấu đêm ngày\nKhác gì gian lận chơi bài quen tay.",
            "Kẻ nhếch mắt truy tìm lầm lỗi\nThường cống cao, chỉ trích, chê bai\nNão phiền theo đó tăng hoài\nCõi lòng an tịnh biết ngày nào đây?",
            "Hư không vốn không lưu dấu vết\nNgoài Phật môn khó kiếm sa-môn\nĐời ham tranh luận vui mồm\nNhư Lai an tịnh, không còn hơn thua.",
            "Hư không vốn không lưu dấu vết\nNgoài Phật môn khó kiếm sa-môn\nHữu vi biến đổi, vô thường\nNhư Lai an tịnh, không còn động tâm.",
            "Bậc pháp trụ  là người chuẩn mực\nKhông sống theo chuyên chế, cực đoan\nTrí nhân cư xử cân phân\nChánh tà, đen trắng rõ ràng không sai.",
            "Bậc pháp trụ là người trí giác\nSống công bằng, dẫn dắt mọi người\nKhông còn chuyên chế, lộng quyền\nSống theo luật pháp cho đời thăng hoa.",
            "Bậc hiền trí chẳng do hiểu rộng\nHay nói nhiều những chuyện trên đời\nKhông thù, không oán sợ người\nAn hòa, đức độ, rạng ngời chánh chân.",
            "Người trì pháp chẳng do lắm miệng\nBiết noi theo chuẩn mực pháp mầu\nThực hành chẳng chút lãng xao\nKhông còn phóng túng, thẩm sâu đạo vàng.",
            "Gọi trưởng lão chẳng vì tóc bạc\nHoặc sống lâu, tuổi tác đã cao\nNhững ai đức, trí không sâu\nGià đầu mê muội khác nào “lão ngu.”",
            "Người thông đạt bốn điều chân lý\nChủ giác quan, tuệ trí, chánh chân\nKhông còn lậu hoặc, tịnh thanh\nTrưởng lão như vậy xứng danh đạo đời.",
            "Đâu phải đẹp, hoặc tài hùng biện\nMà trở thành người thiện chánh chân.\nAi không ích kỷ, hờn ganh\nKhông còn cao ngạo xứng danh bậc hiền.",
            "Bậc hiền thiện là người dứt được\nTham, sân, si – nguồn gốc khổ đau\nTỏ thông trí tuệ làu làu\nĐức tài ngời sáng, đạo mầu tràn dâng.",
            "Là tu sĩ đâu do đầu trọc.\nPhải thực hành, dứt sạch dục tham\nKhông còn phóng túng, dối gian\nHạng sa-môn ấy chánh chân trọn đời.",
            "Ai chuyển hóa ác nhân lớn nhỏ\nDứt tham, sân, sáng tỏ nguồn tâm\nKhông còn ác pháp, tịnh thanh\nHạng sa-môn ấy xứng danh trên đời.",
            "Người tu sĩ phải đâu hành khất\nChỉ biết ôm bình bát xin ăn\nNgười tu chánh pháp hiểu rành\nGiới hạnh đầy đủ, trí nhân sáng ngời.",
            "Người tu sĩ vượt qua thiện, ác\nSống giữ gìn giới đức thanh cao\nDùng nguồn trí tuệ cao sâu\nXét soi vạn pháp, đạo mầu tràn dâng.",
            "Chỉ im lặng mà tâm vô trí\nĐâu gọi là ẩn sĩ đạo cao?\nTrí nhân chọn thiện rất mau\nCán cân hạnh phúc đi đầu mọi duyên.",
            "Bậc ẩn sĩ trong ngoài thấu hiểu\nĐời bây giờ và kiếp tương lai\nDứt trừ ác pháp hôm nay\nXứng danh Thích tử mâu-ni nhiệm mầu.",
            "Bậc hiền thánh không gieo nghiệp sát\nHại con người, động vật, sinh linh.\nTâm từ thương khắp chúng sinh\nLoài vô tình lẫn hữu tình như nhau.",
            "Chẳng vì cớ giữ gìn giới luật\nHay dựa vào học đủ hiểu nhiều\nChẳng vì thiền định cao siêu\nSống nơi thanh vắng sớm chiều độc cư...",
            "Mà có thể tự cho chứng đắc\nTự mãn lòng được phước viễn ly\nChớ nên xao lãng hành trì\nĐến khi lậu hoặc hết thì mới xong.",
            "Bát chánh đạo là đường độc lộ\nChân lý thì Tứ đế cao sâu\nLìa tham ái – quả nhiệm mầu\nChứng nên pháp nhãn dẫn đầu hai chân.",
            "Bát chánh đạo không đường nào khác\nTuệ cao siêu, giải thoát, tịnh thanh\nNoi theo đường ấy thực hành\nNão phiền dứt sạch, ma quân quy hàng.",
            "Theo chánh đạo khổ đau chấm dứt\nCác chướng duyên kết thúc dễ dàng\nNhư Lai chỉ rõ con đường\nTrí tuệ tăng trưởng, không còn tái sinh.",
            "Hãy thực tập nhiệt tình, miên mật\nĐức Như Lai là bậc chỉ đường\nSiêng tu thiền định chuyên ròng\nVượt qua lưới ái ma vương nhiều đời.",
            "Bằng tuệ quán chiếu soi thế giới\nCác hành  kia dính với vô thường\nKhông còn đau khổ sầu vương\nThênh thang cất bước con đường an vui.",
            // PHẦN 3
            "Bằng tuệ quán chiếu soi thế giới\nCác hành kia dính với khổ đau\nKhông còn bất hạnh, muộn sầu\nCon đường thanh tịnh, đạo mầu an vui.",
            "Bằng tuệ quán chiếu soi tất cả\nCác hành kia vô ngã xưa nay\nKhông còn đau khổ ngay đây\nĐạo vàng an lạc phút giây hiện tiền.",
            "Khi cần thiết thì không nỗ lực\nLúc trẻ trung biếng nhác, buông lung\nCầu an, nhu nhược, thủ thường\nLàm sao tìm được con đường cao siêu?",
            "Gìn tâm thức, thân không làm ác\nGiữ ngữ ngôn rất mực chánh chân\nHộ phòng ba nghiệp, thân tâm\nChứng nên đạo giác thánh nhân chỉ bày.",
            "Tu thiền định tăng nhanh trí tuệ\nHiểu con đường hai ngã diệt sanh\nTự mình nỗ lực thực hành\nTrau dồi tuệ giác, đạt thành quả cao.",
            "Trong rừng núi, dục là số một\nRừng dục làm sợ hãi, sầu vương\nĐốn rừng ái dục sạch trơn\nNgười tu tịch tịnh con đường thanh cao.",
            "Dây tình ái gái trai chưa bỏ\nThì khó mong làm chủ được tâm\nRơi vào tình trạng buộc ràng\n“Bò con vú mẹ” dặm đàng chẳng buông.",
            "Tự vứt bỏ sợi dây ái dục\nNhư dùng tay bẻ đứt sen thu\nĐạo tịch tịnh, hãy tiến tu\nNiết-bàn an lạc từ từ chứng nên.",
            "Mùa đông, hạ, nơi đây ta ở\nRồi mùa mưa cũng trụ chỗ này\nNgười ngu ỷ lại như vầy\nĐâu ngờ hiểm “chết” bủa vây, ngóng chờ.",
            "Người vướng kẹt chấp nê sở hữu\nCon cái tôi, tài sản của tôi\nTử thần theo bắt, kéo lôi\nNhư cơn lũ lớn cuốn trôi cả làng.",
            "Khi thần chết kề bên kiếp số\nCha mẹ nào bảo hộ được đâu\nNgười thân, con cái sầu đau\nNghiệp ai nấy chịu, làm sao cứu nàn?",
            "Vô thường đến không ai giúp được\nHiểu được rồi, giới luật trang nghiêm\nMau tu chuyển hóa tinh chuyên\nNiết-bàn chứng đắc trọn nên đạo vàng.",
            "Nhờ từ bỏ niềm vui nhỏ nhặt\nMà đạt thành hạnh phúc lớn hơn\nThú vui ngũ dục chẳng màng\nTrí nhân hưởng đạt niết-bàn an vui.",
            "Gieo đau khổ cho người bị hại\nLại cầu mong gặt hái bình an\nNhững ai thù hận buộc ràng\nKhông sao thoát khỏi trái ngang trong đời.",
            "Việc xứng đáng lại không làm tốt\nViệc chẳng gì lại trút vào thân.\nNgười ngu ngạo mạn, buông lung\nNão phiền, lậu hoặc gia tăng đêm ngày.",
            "Quán thân thể do duyên, bất tịnh\nSiêng năng làm những việc đáng làm\nGiữ gìn chánh niệm thân tâm\nNão phiền, lậu hoặc tiêu tan hết liền.",
            "Giết mẹ ái, cha già ngã mạn\nTrừ hai vua tà kiến: đoạn, thường.\nDẹp mười hai xứ, ái tham\nVị Phạm chí ấy xứng hàng vô ưu.",
            "Giết mẹ ái, cha già ngã mạn\nTrừ hai vua tà kiến: đoạn, thường.\nDiệt luôn hỗ tướng nghi nan\nVị Phạm chí ấy xứng hàng vô ưu.",
            "Đệ tử Phật đêm ngày tỉnh thức\nNiệm Như Lai mười đức vẹn toàn\nCông phu, làm chủ thân tâm\nOai nghi, chính niệm chuyên cần thường xuyên.",
            "Đệ tử Phật đêm ngày tỉnh thức\nNiệm Pháp mầu năm đức vẹn toàn\nCông phu, làm chủ thân tâm\nOai nghi, chính niệm chuyên cần thường xuyên.",
            "Đệ tử Phật đêm ngày tỉnh thức\nNiệm Tăng đoàn giới đức vẹn toàn\nCông phu, làm chủ thân tâm\nOai nghi, chính niệm chuyên cần thường xuyên.",
            "Đệ tử Phật đêm ngày tỉnh thức\nQuán thân này cấu uế, do duyên\nCông phu, làm chủ thân tâm\nOai nghi, chính niệm chuyên cần thường xuyên.",
            "Đệ tử Phật đêm ngày tỉnh thức\nHành từ bi, không giết chúng sinh\nCông phu, làm chủ thân tâm\nVui niềm bất hại, chuyên cần thường xuyên.",
            "Đệ tử Phật đêm ngày tỉnh thức\nThực hành thiền, chuyển hóa tham, sân\nCông phu, làm chủ thân tâm\nOai nghi, chính niệm chuyên cần thường xuyên.",
            "Thật đáng quý xuất gia chân chính\nĐời tại gia lắm chuyện khổ đau\nBuồn thay, bạn chẳng hiểu nhau\nLuân hồi chìm đắm muộn sầu, chớ theo.",
            "Có chính tín, vẹn toàn đức hạnh\nDanh dự tăng, thánh sản cũng tăng\nNơi nào vị ấy đến thăm\nMọi người kính nể, xa gần tôn vinh.",
            "Bậc hiền thiện ở xa vẫn sáng\nNhư núi cao tuyết trắng chói ngời\nÁc nhân gần, chẳng đoái hoài\nNhư tên mất hút đêm dài, vô minh.",
            "Đường độc lộ dứt duyên, thanh vắng\nKhông cô đơn, buồn chán một mình\nNgồi, nằm, đi, đứng lặng thinh\nRừng sâu thoải mái, tịnh thanh cõi lòng.",
            "Kẻ vọng ngữ nói sai sự thật\nCó nói không, thêu dệt, ba hoa\nKẻ ác chối “chẳng phải ta”\nSống làm người xấu, chết sa ngục hình.",
            "Kẻ khoác áo cà-sa giả dạng\nSống buông lung, giới hạnh chẳng gìn\nÁc do nghiệp ác hoành hành\nChết sa cõi dữ, ngục hình phải vương.",
            "Thà nuốt sắt đỏ hừng nóng bức\nHơn buông lung, giới đức chẳng gìn\nĂn đồ tín thí cúng dâng\nLàm sao tiêu nổi nghiệp nhân nhận về.",
            "Bốn tai nạn chờ người dâm đãng\nThích ngoại tình, sống chẳng thủy chung:\nNgủ không ngon giấc, tai ương\nBị đời chế giễu, lầm đường ngục sa.",
            "Không chung thủy họa tai chờ đón\nSống lo âu, thấp thỏm, ít vui,\nVướng vòng luật pháp tiêu đời\nMột chồng một vợ, rạng ngời phước duyên.",
            "Cỏ lau nắm mà sai tư thế\nKhó bình an khỏi họa sướt tay.\nSa-môn giới hạnh chẳng ngay\nĐọa sa tù ngục biết ngày nào ra.",
            "Sống phóng đãng, sáu căn chẳng giữ\nGiới đức thì ô uế, đáng ngờ\nKhông theo hạnh thánh, bỏ tà\nQuả cao khó chứng, quả là không sai.",
            "Điều chân chánh cần làm dứt khoát\nLàm say mê, trút hết khả năng\nXuất gia phóng đãng: phá Tăng\nLàm người tổn tín, hoang mang bụi mù.",
            "Điều xấu ác không nên dính tới\nLàm xong rồi, tù tội khổ đau.\nNhân lành nỗ lực trồng sâu\nTâm không tiếc nuối, chẳng bao giờ phiền.",
            "Như thành lũy trong ngoài canh giữ\nPhòng hộ thân, chớ có buông lung.\nĐời không tu tập: Trầm luân\nĐọa sa vì nỗi lầm đường trần duyên.",
            "Việc không thẹn thì luôn ray rứt\nĐúng lương tâm lại bực là sao?\nSống theo tà kiến: Khổ đau\nĐọa sa cõi xấu, ngụp đầu trầm luân.",
            "Không đáng sợ thì luôn lo lắng\nĐáng sợ thì chẳng hoảng là sao?\nSống theo tà kiến: Khổ đau\nĐọa sa cõi xấu, ngụp đầu trầm luân.",
            "Không có lỗi thì luôn buộc tội\nCó tội mà thoát khỏi là sao?\nSống theo tà kiến: Khổ đau\nĐọa sa cõi xấu, ngụp đầu trầm luân.",
            "Người có lỗi thì cho có lỗi\nKhông tội thì phải nói là không\nNoi theo chánh kiến, thong dong\nChết sanh thiên giới, con đường an vui.",
            "Như voi chiến xông pha giữa trận\nHứng tên rơi, đạn bắn, tấn công\nChịu lời phỉ báng không buồn\nNgười tu tập biết xả buông nhẹ nhàng.",
            "Voi, ngựa quý được đưa dự hội\nĐược vua quan chọn cưỡi trên lưng\nNgười hiền số một hồng trần\nChịu bao phỉ báng của phường ác gian.",
            "Như “ngựa” giống và “la” thuần chủng\nHay voi to, ngà trắng, đẹp ngần\nNhững ai điều phục bản thân\nTrang nghiêm giới hạnh, xứng hàng tối cao.",
            "Chẳng do cỡi ngựa voi quý đắt\nMà giúp người chứng đạt niết-bàn\nNhững người chiến thắng bản thân\nMục tiêu cứu cánh đắc thành dễ thôi.",
            "Voi Tài Hộ hung hăng, khó phục\nTiết mồ hôi, phát dục mỗi khi\nNhốt giam, chẳng uống ăn gì\nNgày đêm canh cánh hướng về rừng voi.",
            "Người biếng nhác thường ham hưởng thụ\nĂn uống nhiều, nằm ngủ cả ngày\nKhác gì như lợn mập thây\nKẻ ngu sinh tử, khó ngày thoát ra.",
            "Bao ngày trước, tâm thường lêu lổng\nTheo thú vui, dục vọng quay cuồng.\nHôm nay, chế ngự được lòng\nNhư người quản tượng cương thường điều voi.",
            "Hãy vui thích với không phóng dật\nGiữ gìn tâm, tỉnh thức, lạc an\nVượt ngoài kiết sử buộc ràng\nNhư voi nỗ lực thoát vòng lầy sa.",
            "Khi gặp được những người hiền trí\nNên sống chung, thỏa chí đồng hành\nVượt qua tất cả hiểm nàn\nSống trong chánh niệm, an lành niềm vui.",
            "Nếu không gặp bạn hiền tuệ đức\nĐáng sống chung, hạnh phúc đồng hành\nThà vua bỏ lại nước, thành\nNhư voi cất bước quẩn quanh rừng già.",
            "Thà đơn độc, sống trong hạnh phúc\nGiới trang nghiêm, không bạn kẻ ngu\nKhông còn buồn khổ, vô tư\nNhư voi trong chốn rừng sâu một mình.",
            "Thật hạnh phúc, bạn khi cần thiết\nBiết đủ là hạnh phúc nào hơn.\nVui thay, chết để đức nhân\nKhổ đau chấm dứt, trần gian niết-bàn.",
            "Thật hạnh phúc, dưỡng nuôi cha mẹ\nPhúc nào hơn kính lễ sa-môn\nVui thay, kính bậc thánh hiền\nPhúc thay, chánh niệm hiện tiền ngay đây.",
            "Thật hạnh phúc tuổi già có đức\nPhúc nào hơn tuệ giác cao siêu\nVui thay, chánh tín, hiểu nhiều\nPhúc thay, từ bỏ bao nhiêu ác tà.",
            "Người dễ dãi sống đời phóng dật\nNhư dây leo, ái dục tăng nhanh\nĐời này kiếp khác chuyền cành\nNhư vượn luyến thoắn tham ăn quả rừng.",
            "Người nào sống trong vòng ba cõi\nBị lòng tham khát ái buộc ràng\nKhổ sầu, bất hạnh gia tăng\nNhư trời mưa, cỏ tràn lan ruộng vườn.",
            "Người nào sống trong vòng ba cõi\nChuyển hóa xong tham ái buộc ràng\nKhổ đau, sầu não tiêu tan\nCũng như giọt nước lá sen, lo gì.",
            "Này đệ tử, Như Lai chỉ dạy\nNhổ cội căn tham ái buộc ràng\nPhá tan uy lực ma quân\nNhư dòng nước lũ ngập tràn bụi lau.",
            "Như cây đốn, gốc còn lại sống\nSẽ đâm chồi mọc vững như xưa\nÁi tùy miên khó giã từ\nKhổ đau già chết dây dưa nhiều đời.",
            "Ba sáu ái như dòng thác chảy\nCuốn người theo khả ái, vấn vương\nCác nguồn tư tưởng ái thương\nCuốn người tà kiến vào đường trầm luân.",
            "Dòng ái dục chảy quanh khắp chốn\nNhư dây leo đeo bám thân cây\nDùng gươm trí tuệ diệt ngay\nDây leo tham ái tại đây, bây giờ.",
            "Bị ám ảnh niềm vui ái dục\nMong bình an chẳng được vào đâu\nKhông còn tham ái đuôi đầu\nSanh già kết thúc, khổ đau không còn.",
            "Người bị vướng niềm vui ái dục\nSống vẫy vùng, hoảng hốt, buộc ràng\nCũng như thỏ bị lưới giăng\nChúng sanh đau khổ trầm luân lâu dài.",
            "Người bị vướng niềm vui tham ái\nNhư thỏ sa lưới bẫy vẫy vùng.\nNgười tu rũ bỏ sầu vương\nVượt qua tham ái, thoát đường tử sanh.",
            "Lìa rừng dục, vướng vào rừng ái\nThoát được rừng lại chạy theo rừng\nNhững người như vậy sầu vương\nCởi dây trói lại buộc ràng khó buông.",
            "Xiềng bằng sắt, dây, mây cũng đứt\nNgười dính vào tham dục khó buông.\nCủa tiền, con cái, vợ chồng...\nNhư xiềng xích chặt, khó lòng thoát ra.",
            "Xích tham ái thật bền, khó chặt\nGhì lún người sắc dục trầm luân\nTrí nhân cắt bỏ buộc ràng\nGiã từ dục lạc, không màng, thong dong.",
            "Người đắm dục tự lao dòng khổ\nNhư nhện giăng bắt bớ con mồi.\nTrí nhân bỏ ái, an vui\nKhông còn đau khổ giữa đời trầm luân.",
            "Buông quá khứ, tương lai, hiện tại\nTrí cao siêu, chẳng ngại, thong dong\nĐến bờ kia, sống ngược dòng\nKhông còn vướng kẹt trong vòng tử sanh.",
            "Người bị ý tà sai kích thích\nÁi tham tăng, mê tít dục trần\nTrói mình trong chốn trầm luân\nVẫy vùng khó thoát khỏi vòng khổ đau.",
            "Thường tỉnh giác, quán thân bất tịnh\nDẹp ý tà, an định thân tâm\nDiệt tan ma ái buộc ràng\nSống trong tự tại, tinh thần lạc an.",
            "Đích cứu cánh đạt rồi hết sợ\nLìa ái tham, ô uế, não phiền\nNhổ tên sanh tử hiểm nàn\nĐây là thân chót, trầm luân không còn.",
            "Lìa ái, thủ, đây là thân chót\nKhéo biện tài, từ, nghĩa, trước, sau\nGiảng rành chánh pháp nhiệm mầu\nXứng danh bậc trí rộng sâu trên đời.",
            "Ta điều phục, làu thông các pháp\nKhông nhiễm ô, ái diệt, xả buông\nLậu hoặc tan, trí tỏ tường\nKhông thầy, ta ngộ con đường cao siêu!",
            "Tặng Phật pháp vượt xa bố thí\nLý chánh chân hơn vị ngọt ngon.\nNiềm vui pháp hỷ tuyệt trần\nDứt tham ái, khổ trầm luân tạ từ.",
            "Vật sở hữu hại người vô trí\nKhông tìm về hương vị bờ kia\nKẻ ngu đắm của vì si\nMình, người bị hại, khó lìa khổ đau.",
            "Cỏ phủ kín làm vườn hư hại\nTánh tham lam phá hoại tấm thân\nCúng dường cho bậc vô tham\nThiện nhân sẽ trổ quả lành lớn hơn.",
            "Cỏ phủ kín làm vườn hư hại\nTâm hận sân phá hoại tấm thân\nCúng dường cho bậc vô sân\nThiện nhân sẽ trổ quả lành lớn hơn.",
            "Cỏ phủ kín làm vườn hư hại\nTâm si mê phá hoại tấm thân\nCúng dường cho bậc tuệ quang\nThiện nhân sẽ trổ quả lành lớn hơn.",
            "Cỏ phủ kín làm vườn hư hại\nTâm dục tham phá hoại tấm thân\nCúng dường cho bậc lìa tham\nThiện nhân sẽ trổ quả lành lớn hơn.",
            "Thật hạnh phúc, giữ gìn hai mắt\nThật lành thay, giữ tốt hai tai\nGiữ gìn lỗ mũi, lưỡi này\nSống trong điều phục ngay đây an lành.",
            "Thật hạnh phúc, giữ gìn thân thể\nThật lành thay, phòng hộ ngữ ngôn\nLành thay, phòng ý ngoài, trong\nNgười tu phòng hộ, không còn khổ đau.",
            "Người làm chủ tay, chân, bộ óc\nLàm chủ lời, vui thích định thiền\nĐộc thân, biết đủ, hạnh nghiêm\nXứng danh tu sĩ, trọn nên quả lành.",
            "Người tu sĩ giữ gìn cửa miệng\nKhông cống cao, giảng thiện cho đời\nTrình bày pháp nghĩa vừa lời\nNgữ ngôn dịu ngọt, giúp người bình an.",
            "Là hành giả mến yêu Phật pháp\nTư duy sâu câu pháp vừa nghe\nĐể tâm theo pháp, lìa mê\nThực hành chánh pháp dẫn về an vui.",
            "Điều mình được không chê lớn nhỏ\nKhông hờn ganh với kẻ được hơn\nTâm không tùy hỷ: Sầu vương\nVọng tâm trỗi dậy khó mong định thiền.",
            "Dù được ít không chê nhỏ ít\nHạnh siêng năng, giới đức nghiêm trang\nGiữ gìn trọn vẹn thân tâm\nChư thiên tán thưởng xứng danh tu hành.",
            "Tu vô ngã không còn chấp mắc\nThân là ta, danh-sắc của ta.\nDứt trừ chấp, hết sầu lo\nNgười tu như thế xứng là Tỳ-kheo.",
            "Bậc hành giã từ bi thực tập\nTâm tín thành Phật pháp cao sâu\nChứng nên tịch tĩnh nhiệm mầu\nCác hành an tịnh trước sau trong ngoài.",
            "Bậc hành giả tát thuyền cạn nước\nThuyền rỗng không, nhẹ lướt thật nhanh\nDiệt trừ si, hận và tham\nẮt rằng chứng đắc niết-bàn thong dong.",
            "Làm hành giả hãy tu thiền quán\nKhông buông lung, say đắm dục trần.\nBuông lung như ngọn lửa hồng\nĐốt thiêu, gây khổ, khó mong an lành.",
            "Thiếu trí tuệ khó mong thiền quán\nKhông định thiền khó đặng trí mầu\nAi người định, tuệ thâm sâu\nNiết-bàn chứng đắc trước sau rõ ràng.",
            "Bậc hành giả ẩn tu nơi vắng\nGìn tâm tư, yên lặng hiện tiền\nQuán theo chánh pháp, hành thiền\nHưởng nguồn hạnh phúc siêu nhiên lạ thường.",
            "Người chính niệm thấu nguồn sanh diệt\nThọ, tưởng, hành, nhận thức, xác thân\nHưởng niềm an lạc, hân hoan\nCác hàng bất tử hiểu rành trước sau.",
            "Người có trí, sống luôn tri túc\nGìn giác quan, tu tập pháp môn\nTinh cần, giới hạnh vẹn tròn\nThân gần thiện hữu, không còn sầu đau.",
            "Khi ứng xử chánh chân, thân thiện\nHạnh đoan trang thể hiện trong ngoài\nThấm nhuần hỷ lạc hiện đời\nKhổ đau kết thúc, thảnh thơi niết-bàn.",
            "Như cây lài bỏ cành tàn úa\nMau hồi sinh cho lá thêm xanh\nCũng vầy, tu sĩ chánh chân\nThực hành tinh tấn, tham sân dứt trừ.",
            "Bậc tịch tịnh chuyên tâm tu tập\nThân tịnh thanh, lời nói an lành\nThực hành thiền định chuyên cần\nBỏ thế sự, hướng niết-bàn an vui.",
            // PHẦN 4
            "Người tu học tự mình dò xét\nĐánh giá mình nhân cách đục trong\nGiữ gìn chánh niệm, tự phòng\nTrụ an lạc, để tâm không muộn phiền.",
            "Người tu Phật tự mình nương tựa\nTìm được nguồn ẩn trú bản thân\nTự mình điều phục nguồn tâm\nNhư người buôn có ngựa thuần đường xa.",
            "Người tu sĩ tâm thường hoan hỷ\nĐặt niềm tin pháp vị cao siêu\nAn lành tịch tịnh trọn nên\nCác hành hữu lậu lặng yên, nhẹ nhàng.",
            "Bậc hành giả tuổi đời tuy nhỏ\nTu pháp môn sáng tỏ nguồn tâm\nTrí mầu soi sáng thế gian\nNhư vầng trăng thoát mây ngàn bủa giăng.",
            "Hãy tinh tấn dứt dòng ái dục\nBỏ thú vui vật chất bao đời\nCác hành đoạn diệt, thảnh thơi\nBà-la-môn ấy rạng ngời vô vi.",
            "Nhờ an trụ pháp tu chỉ, quán\nMà tiến về bỉ ngạn an vui\nBà-la-môn trí sáng ngời\nDiệt trừ kiết sử, thảnh thơi đạo vàng.",
            "Người không chấp bờ này, bờ nọ\nTâm chẳng màng chấp có, chấp không\nKhổ đau dứt, trói buộc buông\nNgười tu ấy Bà-la-môn tuyệt vời.",
            "Tu thiền định, ẩn cư, không nhiễm\nLậu hoặc lìa, bổn phận đã xong.\nHoàn thành mục đích tối tôn\nNgười tu ấy Bà-la-môn sáng ngời.",
            "Trời, trăng sáng ngày, đêm tùy lúc\nCác vua quan sáng rực kiếm cung\nTu thiền chói sáng ngoài trong\nTrí tuệ Phật sáng soi chung đất trời.",
            "Người dứt ác xứng hàng Phạm chí\nHạnh thanh cao xứng vị Sa-môn\nXuất gia hết cấu uế tâm\nXứng danh thượng sĩ xuất trần xưa nay.",
            "Đừng hãm hại Sa-môn, Phạm chí\nGặp nghịch duyên xin chớ trả thù.\nKhổ thay, hại bậc chân tu\nChớ nên trả đũa oán cừu mà chi.",
            "Bậc Phạm chí tâm không tham ái\nKhông trả thù, sân, hại một ai\nKhổ đau dứt sạch trong ngoài\nNiềm vui to lớn, nạn tai không còn.",
            "Người không tạo nghiệp nhân ác độc\nMiệng, ý, thân trau chuốt, giữ gìn\nHành vi, lối sống tịnh thanh\nXứng danh Phạm chí hiền minh, đức từ.",
            "Biết đền đáp ân sâu của bậc\nHướng dẫn ta hiểu Phật, Pháp, Tăng\nThành tâm lễ tạ, cúng dàng\nNhư người Phạm chí thờ thần lửa kia.",
            "Gọi Phạm chí đâu vì bện tóc\nGiai cấp hay chủng tộc bảy đời\nChân thành, chánh niệm, thảnh thơi\nBà-la-môn ấy sáng ngời đức tu.",
            "Phạm chí “ngố” chỉ lo bện tóc\nLợi ích gì áo mặc da dê\nTâm còn phiền não, u mê\nTu toàn hình thức, đường về còn xa.",
            "Phạm chí “ngố” mặc y vá nhớp\nDa lộ gân, thân hốc hác gầy.\nNgười tu thiền định đêm ngày\nBà-la-môn ấy sánh tày núi cao.",
            "Phạm chí thật đâu do huyết thống\nGiai cấp cao, nguồn gốc thọ sanh.\nAi không phiền não, tịnh thanh\nPhạm chí không chấp, cõi tâm an lành.",
            "Người dứt sạch cả mười trói buộc\nKhông sầu lo được, mất, thua, hơn\nBao điều chấp trước xả buông\nNgười tu ấy Bà-la-môn tuyệt vời.",
            "Bậc Phạm chí bỏ đai “sân hận”\nCắt cương “tham”, tà kiến, tùy miên\nVô minh hết, trí trọn nên\nHướng về giác ngộ, thoát miền trầm luân.",
            "Lấy đức nhẫn làm quân xông trận\nKhông ác tâm, phỉ báng, phạt hình\nTừ bi, từ bỏ hận, sân\nBà-la-môn ấy sáng danh đạo đời.",
            "Không tức giận, làm tròn bổn phận,\nGiới thanh cao, ái, hận không còn\nGiác quan làm chủ luôn luôn\nThân này cuối, Bà-la-môn sáng ngời.",
            "Người đã dứt dục tâm hoen ố\nCó khác gì “nước đổ lá sen”\nCũng như “hạt cải đầu kim”\nBà-la-môn ấy xứng hàng chân tu.",
            "Phạm chí học trên đời hiểu rõ\nNào khổ đau, gốc khổ, niết-bàn\nNương theo chánh đạo tu hành\nÁi sạch, giải thoát, rạng danh trên đời.",
            "Người có trí thực hành hiểu rõ\nNguồn gốc từ hai nẻo chánh tà.\nChứng đạo giải thoát sâu xa\nBà-la-môn ấy thật là xứng danh.",
            "Không thân thiết cả Tăng lẫn Tục\nHạnh độc cư, thiểu dục, hài lòng\nNhư mây đây đó thong dong\nAn vui, tự tại, không còn sầu đau.",
            "Ngừng nghiệp sát, tổn thương sinh mạng\nYếu hơn ta hay mạnh khỏe hơn\nKhông ưa sai bảo, tán đồng\nĐây là Phạm chí xứng hàng chân tu.",
            "Sống thân thiện giữa bao thù nghịch\nGiữ ôn hòa với địch hung hăng\nTịnh thanh giữa chốn hồng trần\nBà-la-môn ấy xứng hàng chân tu.",
            "Người tu tập không còn dính dáng\nTham, sân, si, kiêu mạn, tị hiềm\nCũng như hạt cải đầu kim\nBà-la-môn ấy trọn nên đạo vàng.",
            "Người tu tập nói lời từ ái\nChân thật và ích lợi cho đời\nKhông hề làm mất lòng người\nBà-la-môn ấy sáng ngời tấm gương.",
            "Người tu tập tránh xa trộm cắp\nVật không cho không lấy, chỉa chôm\nCho dù lớn, nhỏ, quý, thường.\nBà-la-môn ấy tấm gương sáng ngời.",
            "Không tham vọng đời này, đời tới\nKhông dính gì ba cõi trầm luân\nBuông tất cả, giải thoát tâm\nBà-la-môn ấy rạng danh đạo đời.",
            "Người tu tập không vương ái dục\nTrí tuệ nhiều, nghi hoặc không còn\nChứng vào cảnh giới niết-bàn\nBà-la-môn ấy xứng hàng chân tu.",
            "Ai không vướng chuyện đời thiện ác,\nTu xả ly, giải thoát buộc ràng\nKhông sầu, thanh tịnh, lạc an\nBà-la-môn ấy xứng hàng chân tu.",
            "Như trăng sáng thoát mây che khuất\nAn tịnh lòng, hết trược, sáng trong\nĐam mê hiện hữu dứt xong\nBà-la-môn ấy vào dòng thánh nhân.",
            "Hết tham ái, không nghi, không chấp\nVượt hiểm nguy sống chết, luân hồi\nThực hành thiền định, đến nơi\nPhạm chí tịch tịnh, thảnh thơi vượt dòng.",
            "Vì lý tưởng xuất gia, học đạo\nLìa gia đình, dục lạc chẳng màng\nDứt trừ hiện hữu, ái tham\nBà-la-môn ấy xứng hàng chân tu.",
            "Vì lý tưởng xuất gia, học đạo\nLìa gia đình, khát ái chẳng màng\nDứt trừ hiện hữu, ái tham\nBà-la-môn ấy xứng hàng chân tu.",
            "Tu thoát khỏi buộc ràng hai cõi\nThế giới người, cảnh giới chư thiên\nBuộc ràng, giải thoát không còn\nBà-la-môn ấy vào dòng thánh nhân.",
            "Không vướng bận những điều ưa ghét\nHết sanh y, năm uẩn vượt qua\nAnh hùng chiến thắng nhiễm ô\nBà-la-môn ấy thật là chân tu.",
            "Ai hiểu rõ đường đi sống chết\nKhông nhiễm ô, sáng suốt vượt lên\nHọc Tứ đế, ngộ lý chân\nBà-la-môn ấy xứng danh tu hành.",
            "Với hành giả mà trời, thần, quỷ\nKhông một ai biết chỗ tái sanh\nLậu hoặc hết, chứng thánh nhân\nBà-la-môn ấy xứng hàng chân tu.",
            "Người không dính vị lai, quá khứ\nHiện tại thì chẳng sở hữu gì\nXả buông, chẳng kẹt thứ chi\nBà-la-môn ấy sánh vì trăng sao.",
            "Như trâu chúa sức thần uy dũng\nBậc anh hùng, chiến thắng nhiễm tham\nTrí mầu giác ngộ, tịnh thanh\nBà-la-môn ấy xứng danh tu hành.",
            "Rõ quá khứ, vị lai, hiện tại\nCõi trời, người, cảnh giới tái sanh\nMâu ni, thắng trí, viên thành\nTử sanh kết thúc, sáng danh đạo đời."
        ];

        // --- HÀM HỖ TRỢ ---
        const formatDateTimeForInput = (date) => {
            if (!date) return '';
            const d = new Date(date);
            const pad = (n) => n.toString().padStart(2, '0');
            return `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())}T${pad(d.getHours())}:${pad(d.getMinutes())}`;
        };

        const formatDisplayDate = (seconds) => {
            if (!seconds) return '';
            return new Date(seconds * 1000).toLocaleString('vi-VN', { hour: '2-digit', minute:'2-digit', day:'2-digit', month:'2-digit' });
        };

        const getRemainingTime = (timestamp) => {
            if (!timestamp) return null;
            const now = new Date();
            const deadline = new Date(timestamp.seconds * 1000);
            const diff = deadline - now;
            if (diff < 0) {
                const overdueDays = Math.floor(Math.abs(diff) / (1000 * 60 * 60 * 24));
                const overdueHours = Math.floor((Math.abs(diff) % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                let text = "Quá hạn ";
                if (overdueDays > 0) text += `${overdueDays} ngày`;
                else text += `${overdueHours} giờ`;
                return { text: text, isOverdue: true };
            }
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            if (days > 0) return { text: `Còn ${days} ngày, ${hours} giờ`, isOverdue: false };
            if (hours > 0) return { text: `Còn ${hours} giờ, ${minutes} phút`, isOverdue: false };
            return { text: 'Sắp đến hạn', isOverdue: false };
        };

        const getLunarDate = (date) => {
            try {
                const formatter = new Intl.DateTimeFormat('vi-VN', { calendar: 'chinese', day: 'numeric', month: 'numeric' });
                const parts = formatter.formatToParts(date);
                return `${parts.find(p => p.type === 'day').value}/${parts.find(p => p.type === 'month').value}`;
            } catch (e) { return ''; }
        };

        const getLunarDetails = (date) => {
            try {
                const formatter = new Intl.DateTimeFormat('vi-VN', { calendar: 'chinese', day: 'numeric', month: 'numeric' });
                const parts = formatter.formatToParts(date);
                return { 
                    day: parseInt(parts.find(p => p.type === 'day').value),
                    month: parseInt(parts.find(p => p.type === 'month').value)
                };
            } catch (e) { return { day: 0, month: 0 }; }
        };

        const getDayOfWeek = (date) => {
            const days = ['Chủ Nhật', 'Thứ Hai', 'Thứ Ba', 'Thứ Tư', 'Thứ Năm', 'Thứ Sáu', 'Thứ Bảy'];
            return days[date.getDay()];
        };

        const sendNotification = (title, body) => {
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification(title, { body, icon: '/favicon.ico' });
            }
        };

        // --- CÁC COMPONENT CON ---
        const SettingsModal = ({ theme, onSave, onClose }) => {
            const [localTheme, setLocalTheme] = useState(theme);
            return (
                <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
                    <div className="bg-white w-full max-w-sm rounded-xl shadow-2xl overflow-hidden">
                        <div className="bg-gray-800 text-white p-4 flex justify-between items-center">
                            <h3 className="font-bold flex items-center gap-2"><Palette size={18}/> Giao Diện</h3>
                            <button onClick={onClose}><X size={20}/></button>
                        </div>
                        <div className="p-6 space-y-6">
                            <div>
                                <label className="block text-sm font-bold text-gray-700 mb-2">Màu Nền Ứng Dụng</label>
                                <input type="color" className="w-full h-12 rounded cursor-pointer border-2 border-gray-200" value={localTheme.bgColor} onChange={e => setLocalTheme({...localTheme, bgColor: e.target.value})} />
                            </div>
                            <div>
                                <label className="block text-sm font-bold text-gray-700 mb-2">Màu Nền Ghi Chú</label>
                                <input type="color" className="w-full h-12 rounded cursor-pointer border-2 border-gray-200" value={localTheme.noteColor} onChange={e => setLocalTheme({...localTheme, noteColor: e.target.value})} />
                            </div>
                            <div>
                                <label className="block text-sm font-bold text-gray-700 mb-2">Màu Chữ Chính</label>
                                <input type="color" className="w-full h-12 rounded cursor-pointer border-2 border-gray-200" value={localTheme.textColor} onChange={e => setLocalTheme({...localTheme, textColor: e.target.value})} />
                            </div>
                            <button onClick={() => onSave(localTheme)} className="w-full bg-blue-600 text-white py-2 rounded-lg font-bold hover:bg-blue-700 shadow-md">Lưu & Đồng Bộ</button>
                            <button onClick={() => onSave({ bgColor: '#f3f4f6', noteColor: '#FEFCE8', textColor: '#1F2937' })} className="w-full border border-gray-300 text-gray-600 py-2 rounded-lg text-sm">Khôi phục mặc định</button>
                        </div>
                    </div>
                </div>
            );
        };

        const AuthScreen = ({ auth, appId }) => {
            const [isLogin, setIsLogin] = useState(true);
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');

            const handleAuth = async (e) => {
                e.preventDefault();
                setError('');
                try {
                    if (isLogin) await signInWithEmailAndPassword(auth, email, password);
                    else await createUserWithEmailAndPassword(auth, email, password);
                } catch (err) {
                    setError("Lỗi: " + err.message);
                }
            };

            return (
                <div className="flex h-screen items-center justify-center bg-blue-50 p-6">
                    <div className="w-full max-w-sm bg-white rounded-2xl shadow-xl p-8 border border-blue-100">
                        <div className="flex justify-center mb-6"><div className="bg-blue-100 p-4 rounded-full"><User className="text-blue-600" size={32} /></div></div>
                        <h2 className="text-2xl font-bold text-center text-gray-800 mb-2">{isLogin ? 'Đăng Nhập' : 'Đăng Ký'}</h2>
                        <div className="text-center mb-6"><span className="text-[10px] px-2 py-1 rounded font-mono border bg-green-100 text-green-700 border-green-200">Server: <b>{appId}</b></span></div>
                        <form onSubmit={handleAuth} className="space-y-4">
                            <input type="email" required className="w-full px-4 py-3 border border-gray-200 rounded-lg" placeholder="Email" value={email} onChange={e => setEmail(e.target.value)} />
                            <input type="password" required className="w-full px-4 py-3 border border-gray-200 rounded-lg" placeholder="Mật khẩu" value={password} onChange={e => setPassword(e.target.value)} />
                            {error && <p className="text-red-500 text-sm text-center">{error}</p>}
                            <button type="submit" className="w-full bg-blue-600 text-white font-bold py-3 rounded-lg shadow-md">{isLogin ? 'Vào Ứng Dụng' : 'Tạo Tài Khoản'}</button>
                        </form>
                        <div className="mt-6 text-center text-sm">
                            <button onClick={() => setIsLogin(!isLogin)} className="text-blue-600 hover:underline">{isLogin ? 'Chưa có tài khoản? Đăng ký ngay' : 'Đã có tài khoản? Đăng nhập'}</button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- MÀN HÌNH THỜI KHÓA BIỂU (TKB VIEW - GIAO DIỆN BẢNG FULL) ---
        const TimeTableView = ({ user, db, appId, theme }) => {
            const [schedule, setSchedule] = useState({});
            const [headers, setHeaders] = useState({ col1: 'Môn - Lớp', col2: 'Ghi chú' });
            
            const weekDays = [
                { id: 't2', label: 'Thứ 2', color: 'bg-blue-50' }, 
                { id: 't3', label: 'Thứ 3', color: 'bg-green-50' }, 
                { id: 't4', label: 'Thứ 4', color: 'bg-yellow-50' },
                { id: 't5', label: 'Thứ 5', color: 'bg-red-50' }, 
                { id: 't6', label: 'Thứ 6', color: 'bg-purple-50' }, 
                { id: 't7', label: 'Thứ 7', color: 'bg-pink-50' },
            ];
            const periods = [1, 2, 3, 4, 5];

            const tkbRef = useMemo(() => doc(db, 'artifacts', appId, 'users', user.uid, 'timetable', 'main'), [db, appId, user.uid]);

            useEffect(() => onSnapshot(tkbRef, (docSnap) => {
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    setSchedule(data.schedule || {});
                    if(data.headers) setHeaders(data.headers);
                }
            }), [tkbRef]);

            const saveData = async (path, value) => {
                // Fix: Update state locally first for responsiveness
                setSchedule(prev => ({...prev, [path]: value}));
            };
            
            // Debounce save to Firestore to prevent too many writes/lags
            useEffect(() => {
                const timeoutId = setTimeout(() => {
                    if (Object.keys(schedule).length > 0) {
                         setDoc(tkbRef, { schedule }, { merge: true });
                    }
                }, 1000);
                return () => clearTimeout(timeoutId);
            }, [schedule, tkbRef]);


            const saveHeader = async (key, value) => {
                const newHeaders = { ...headers, [key]: value };
                setHeaders(newHeaders);
                await setDoc(tkbRef, { headers: newHeaders }, { merge: true });
            };

            return (
                <div className="h-full flex flex-col px-4 pb-4 pt-2" style={{ color: theme.textColor }}>
                     <h2 className="text-xl font-bold mb-2 text-center shrink-0">Thời Khóa Biểu</h2>
                    <div className="flex-1 overflow-y-auto bg-white rounded-xl shadow-sm border border-gray-200 mb-4">
                        <table className="w-full text-sm border-collapse">
                            <thead className="sticky top-0 bg-gray-100 z-10 shadow-sm">
                                <tr className="text-gray-700">
                                    <th className="border p-2 w-16 bg-gray-100 text-center align-middle">Thứ<br/><span className="text-xs font-normal">Ngày</span></th>
                                    <th className="border p-2 w-10 bg-gray-100 text-center">Tiết</th>
                                    <th className="border p-0 min-w-[80px] bg-gray-100">
                                        <input className="w-full bg-transparent text-center font-bold p-2 outline-none placeholder-gray-400" value={headers.col1} onChange={e=>saveHeader('col1', e.target.value)} placeholder="Môn - Lớp" />
                                    </th>
                                    <th className="border p-0 min-w-[80px] bg-gray-100">
                                        <input className="w-full bg-transparent text-center font-bold p-2 outline-none placeholder-gray-400" value={headers.col2} onChange={e=>saveHeader('col2', e.target.value)} placeholder="Ghi chú" />
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                {weekDays.map(day => (
                                    <React.Fragment key={day.id}>
                                        {periods.map((period, index) => (
                                            <tr key={`${day.id}_${period}`} className={`border-b hover:bg-gray-100 ${day.color}`}>
                                                {index === 0 && (
                                                    <td className="border p-0 align-middle font-bold text-gray-600 bg-white" rowSpan={5}>
                                                        <div className="flex flex-col h-full justify-center items-center">
                                                            <div className="font-bold py-1">{day.label}</div>
                                                            <textarea 
                                                                className="w-full bg-transparent text-center p-1 outline-none text-xs resize-none h-12 overflow-hidden border-t border-dashed"
                                                                placeholder="Ngày..."
                                                                value={schedule[`day_${day.id}_date`] || ''}
                                                                onChange={e=>saveData(`day_${day.id}_date`, e.target.value)}
                                                            />
                                                        </div>
                                                    </td>
                                                )}
                                                <td className="border p-2 text-center text-gray-500 font-medium align-middle bg-white/50">{period}</td>
                                                <td className="border p-0 align-middle">
                                                    <textarea 
                                                        className="w-full h-full p-2 outline-none bg-transparent resize-none overflow-hidden" 
                                                        rows={1}
                                                        value={schedule[`${day.id}_${period}_col1`] || ''}
                                                        onChange={(e) => saveData(`${day.id}_${period}_col1`, e.target.value)}
                                                    />
                                                </td>
                                                <td className="border p-0 align-middle">
                                                    <textarea 
                                                        className="w-full h-full p-2 outline-none bg-transparent resize-none overflow-hidden" 
                                                        rows={1}
                                                        value={schedule[`${day.id}_${period}_col2`] || ''}
                                                        onChange={(e) => saveData(`${day.id}_${period}_col2`, e.target.value)}
                                                    />
                                                </td>
                                            </tr>
                                        ))}
                                    </React.Fragment>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        // --- MÀN HÌNH LỊCH NGÀY (DAILY VIEW - ĐÃ CHỈNH FULL 100%) ---
        const DailyView = ({ user, db, appId }) => {
            const [today, setToday] = useState(new Date());
            const [weather, setWeather] = useState(null);
            const [verses, setVerses] = useState([]);
            const [currentVerse, setCurrentVerse] = useState(DEFAULT_VERSES[0]);
            const [animClass, setAnimClass] = useState('');
            const [locationName, setLocationName] = useState('Hanoi');
            const [searchQuery, setSearchQuery] = useState('');
            const [todayEvents, setTodayEvents] = useState([]);
            const [isNewYearWish, setIsNewYearWish] = useState(false);
            
            const [viewMode, setViewMode] = useState('verse');
            const [showMenu, setShowMenu] = useState(false);
            const [showAddVerse, setShowAddVerse] = useState(false);
            const [newVerse, setNewVerse] = useState('');

            const [touchStart, setTouchStart] = useState(null);
            const onTouchStart = (e) => {
                if (e.touches.length > 1) return;
                setTouchStart(e.targetTouches[0].clientX);
            }
            const onTouchEnd = (e) => {
                if (!touchStart || e.changedTouches.length > 1) return;
                const distance = touchStart - e.changedTouches[0].clientX;
                const newDate = new Date(today);
                if (distance > 50) { 
                    setAnimClass('anim-next');
                    setTimeout(() => { newDate.setDate(today.getDate() + 1); setToday(newDate); setAnimClass(''); }, 400);
                }
                if (distance < -50) { 
                    setAnimClass('anim-prev');
                    setTimeout(() => { newDate.setDate(today.getDate() - 1); setToday(newDate); setAnimClass(''); }, 400);
                }
                setTouchStart(null);
            }
            
            const goNextDay = () => { setAnimClass('anim-next'); setTimeout(() => { const d = new Date(today); d.setDate(today.getDate()+1); setToday(d); setAnimClass(''); }, 300); }
            const goPrevDay = () => { setAnimClass('anim-prev'); setTimeout(() => { const d = new Date(today); d.setDate(today.getDate()-1); setToday(d); setAnimClass(''); }, 300); }
            const stopSwipe = (e) => e.stopPropagation();

            useEffect(() => {
                const isNewYear = today.getDate() === 1 && today.getMonth() === 0;
                if (isNewYear) {
                     setCurrentVerse(`Nhân dịp năm mới ${today.getFullYear()}.\nXin kính chúc mọi người và gia đình một năm mới dồi dào sức khỏe, hạnh phúc và bình an!\n\n_ Văn Trung`);
                     setIsNewYearWish(true);
                } else {
                     setIsNewYearWish(false);
                     const allVerses = [...DEFAULT_VERSES, ...verses.map(v => v.text)];
                     if(allVerses.length > 0) setCurrentVerse(allVerses[Math.floor(Math.random() * allVerses.length)]);
                }
            }, [today, verses]);

            const verseRef = useMemo(() => collection(db, 'artifacts', appId, 'users', user.uid, 'verses'), [db, appId, user.uid]);
            useEffect(() => onSnapshot(query(verseRef), snap => { const data = snap.docs.map(d => ({id: d.id, ...d.data()})); setVerses(data); }), [verseRef]);

            const eventsRef = useMemo(() => collection(db, 'artifacts', appId, 'users', user.uid, 'events'), [db, appId, user.uid]);
            useEffect(() => onSnapshot(query(eventsRef), snap => {
                const allEvents = snap.docs.map(d => ({id: d.id, ...d.data()}));
                const dateStr = today.toDateString();
                const lunar = getLunarDetails(today);
                const todays = allEvents.filter(e => {
                    if (!e.repeat || e.repeat === 'none') return e.date && new Date(e.date.seconds * 1000).toDateString() === dateStr;
                    if (e.repeat === 'lunar') return e.lunarDay === lunar.day && e.lunarMonth === lunar.month;
                    if (e.repeat === 'solar' && e.date) { const d = new Date(e.date.seconds * 1000); return d.getDate() === today.getDate() && d.getMonth() === today.getMonth(); }
                    return false;
                });
                setTodayEvents(todays);
            }), [today, eventsRef]);

            useEffect(() => {
                const fetchWeather = async () => {
                    try {
                        const geoRes = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${locationName}&count=1&language=vi&format=json`);
                        const geoData = await geoRes.json();
                        if (geoData.results && geoData.results.length > 0) {
                            const { latitude, longitude } = geoData.results[0];
                            const weatherRes = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&daily=weathercode,temperature_2m_max,temperature_2m_min&timezone=auto`);
                            const weatherData = await weatherRes.json();
                            setWeather(weatherData.daily);
                        }
                    } catch (e) { console.error("Lỗi thời tiết", e); }
                };
                if (viewMode === 'weather') fetchWeather();
            }, [locationName, viewMode]);

            const handleSearch = (e) => { e.preventDefault(); if(searchQuery.trim()) { setLocationName(searchQuery); } };
            const handleAddVerse = async () => { if (newVerse.trim()) { await addDoc(verseRef, { text: newVerse, createdAt: serverTimestamp() }); setNewVerse(''); setShowAddVerse(false); } };
            const handleDeleteVerse = async (text) => {
                const verseToDelete = verses.find(v => v.text === text);
                if (verseToDelete && window.confirm("Xóa câu danh ngôn này?")) { await deleteDoc(doc(verseRef, verseToDelete.id)); getRandomVerse(); } 
                else if (!verseToDelete) { alert("Đây là danh ngôn mặc định, không thể xóa."); }
            };

            const bgImage = isNewYearWish 
                ? "https://images.unsplash.com/photo-1516132006923-6cf348e5dee2?q=80&w=1000&auto=format&fit=crop" 
                : BACKGROUNDS[today.getDate() % BACKGROUNDS.length];
                
            const getRandomVerse = () => { const allVerses = [...DEFAULT_VERSES, ...verses.map(v => v.text)]; setCurrentVerse(allVerses[Math.floor(Math.random() * allVerses.length)]); };
            const getWeatherIcon = (code) => {
                if (code <= 3) return <Sun size={20} className="text-yellow-400"/>;
                if (code <= 60) return <Cloud size={20} className="text-gray-200"/>;
                return <CloudRain size={20} className="text-blue-300"/>;
            };
            const weekDays = ['CN', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7'];
            const getVerseFontSize = (text) => { const len = text.length; if (len < 50) return 'text-xl'; if (len < 100) return 'text-lg'; if (len < 200) return 'text-sm'; return 'text-xs'; };

            const renderCenterContent = () => {
                if (viewMode === 'weather') {
                    return (
                        <div className="w-full" onTouchStart={stopSwipe} onTouchEnd={stopSwipe}>
                            <form onSubmit={handleSearch} className="flex items-center gap-2 mb-4 bg-white/20 p-2 rounded-lg w-full">
                                <button type="submit" className="p-1 hover:bg-white/10 rounded">
                                     <Search size={16} className="text-white shrink-0"/>
                                </button>
                                <input className="flex-1 bg-transparent outline-none text-white placeholder-white/70 text-sm font-bold text-right" placeholder="Nhập tên TP..." value={searchQuery} onChange={e=>setSearchQuery(e.target.value)} />
                            </form>
                             <div className="text-xs font-bold uppercase text-yellow-300 text-center mb-2">{locationName}</div>

                            <div className="flex justify-between overflow-x-auto no-scrollbar gap-2 pb-2">
                                {weather ? weather.time.slice(0, 7).map((t, i) => (
                                    <div key={t} className="flex flex-col items-center min-w-[40px] bg-black/20 p-2 rounded-lg">
                                        <span className="text-[10px] opacity-80 mb-1">{weekDays[new Date(t).getDay()]}</span>
                                        <div className="my-1 scale-90">{getWeatherIcon(weather.weathercode[i])}</div>
                                        <div className="text-[10px] flex flex-col items-center">
                                            <span className="font-bold">{Math.round(weather.temperature_2m_max[i])}°</span>
                                            <span className="opacity-60">{Math.round(weather.temperature_2m_min[i])}°</span>
                                        </div>
                                    </div>
                                )) : <span className="text-xs animate-pulse">Đang tải dữ liệu...</span>}
                            </div>
                        </div>
                    );
                }

                if (viewMode === 'events') {
                     return (
                        <div className="w-full h-full overflow-y-auto no-scrollbar" onTouchStart={stopSwipe} onTouchEnd={stopSwipe}>
                            <h4 className="text-sm font-bold mb-2 border-b border-white/20 pb-1">Sự kiện hôm nay</h4>
                            {todayEvents.length === 0 ? <p className="text-center text-xs opacity-60 mt-4">Không có sự kiện nào.</p> : (
                                <ul className="space-y-2">{todayEvents.map(e => (<li key={e.id} className="text-sm bg-white/10 p-2 rounded flex items-center gap-2"><Bell size={12} className="text-yellow-300" /><span>{e.title}</span></li>))}</ul>
                            )}
                        </div>
                    );
                }

                return (
                    <div className="text-center w-full flex flex-col h-full relative">
                        {showAddVerse ? (
                             <div className="flex flex-col gap-2 h-full" onTouchStart={stopSwipe} onTouchEnd={stopSwipe}>
                                <textarea className="flex-1 bg-white/20 rounded p-2 text-sm text-white placeholder-white/50 outline-none resize-none" placeholder="Nhập câu danh ngôn..." value={newVerse} onChange={e=>setNewVerse(e.target.value)}></textarea>
                                <div className="flex gap-2 justify-end">
                                    <button onClick={()=>setShowAddVerse(false)} className="text-xs bg-gray-500/50 px-2 py-1 rounded">Hủy</button>
                                    <button onClick={handleAddVerse} className="text-xs bg-blue-500 px-2 py-1 rounded">Lưu</button>
                                </div>
                             </div>
                        ) : (
                            <>
                                <div className="flex justify-end gap-2 mb-1 absolute bottom-1 right-1">
                                     <button onClick={(e)=>{e.stopPropagation(); setShowAddVerse(true)}} className="p-1 opacity-40 hover:opacity-100"><Plus size={12}/></button>
                                     <button onClick={(e)=>{e.stopPropagation(); handleDeleteVerse(currentVerse)}} className="p-1 opacity-40 hover:opacity-100 text-red-300"><Trash2 size={12}/></button>
                                </div>
                                <div className={`flex-1 flex flex-col items-center justify-center font-sans font-medium leading-relaxed whitespace-pre-wrap ${getVerseFontSize(currentVerse)} overflow-y-auto no-scrollbar`} onClick={getRandomVerse}>
                                    <div>"{currentVerse}"</div>
                                    {isNewYearWish && <div className="text-right italic mt-2 text-sm font-normal w-full px-4">_ Văn Trung</div>}
                                </div>
                                <div className="text-[10px] mt-2 opacity-40 flex items-center justify-center gap-1 shrink-0"><BookOpen size={10}/> Chạm để đổi câu khác</div>
                            </>
                        )}
                    </div>
                );
            };

            return (
                <div className="h-full flex flex-col relative text-white overflow-hidden perspective-container" onTouchStart={onTouchStart} onTouchEnd={onTouchEnd}>
                    <div className="absolute inset-0 bg-gray-900 z-0">
                        <img src={bgImage} className="w-full h-full object-cover opacity-80 transition-opacity duration-500" alt="background" />
                    </div>
                    
                    <button onClick={goPrevDay} className="absolute left-4 top-1/2 -translate-y-1/2 z-40 p-2 bg-black/20 hover:bg-black/50 rounded-full text-white/50 hover:text-white transition"><ChevronLeft size={32}/></button>
                    <button onClick={goNextDay} className="absolute right-4 top-1/2 -translate-y-1/2 z-40 p-2 bg-black/20 hover:bg-black/50 rounded-full text-white/50 hover:text-white transition"><ChevronRight size={32}/></button>

                    <div className={`relative z-10 flex-1 flex flex-col items-center gap-2 overflow-hidden ${animClass}`}>
                        
                        {/* Khu vực Ngày chính */}
                        <div className="text-center drop-shadow-lg mt-12 z-20 flex-shrink-0 cursor-pointer hover:scale-105 transition-transform" onClick={() => setToday(new Date())} title="Về hôm nay">
                            <p className="text-2xl font-light uppercase tracking-widest mb-1 text-white/90">{getDayOfWeek(today)}</p>
                            <h2 className="text-[7rem] md:text-[8rem] font-bold leading-none text-white">{today.getDate()}</h2>
                            <p className="text-xl mt-2 font-medium text-white/90">Tháng {today.getMonth() + 1} - {today.getFullYear()}</p>
                            <div className="mt-4 inline-block bg-white/20 backdrop-blur-sm px-6 py-2 rounded-full text-base border border-white/30 font-serif">
                                Âm lịch: {getLunarDate(today)}
                            </div>
                        </div>

                        {/* Thẻ Thông Tin Trung Tâm (Tự giãn) */}
                        <div className="w-full max-w-md mt-auto relative group z-30 flex-1 flex flex-col justify-end pb-0">
                            <div className="bg-black/20 backdrop-blur-sm rounded-t-2xl p-6 border-t border-x border-white/10 flex-1 flex flex-col justify-center items-center relative transition-all duration-300">
                                <div className="absolute top-3 right-3">
                                    <button onClick={(e) => { e.stopPropagation(); setShowMenu(!showMenu); }} className="p-1 opacity-60 hover:opacity-100 transition bg-black/20 rounded-full"><MoreVertical size={16} /></button>
                                    {showMenu && (
                                        <div className="absolute right-0 top-8 bg-white text-gray-800 rounded-lg shadow-xl w-32 py-1 z-50 fade-in overflow-hidden text-sm font-medium">
                                            <button onClick={() => { setViewMode('verse'); setShowMenu(false); }} className={`block w-full text-left px-4 py-2 hover:bg-gray-100 ${viewMode==='verse'?'text-blue-600 bg-blue-50':''}`}>Danh ngôn</button>
                                            <button onClick={() => { setViewMode('weather'); setShowMenu(false); }} className={`block w-full text-left px-4 py-2 hover:bg-gray-100 ${viewMode==='weather'?'text-blue-600 bg-blue-50':''}`}>Thời tiết</button>
                                            <button onClick={() => { setViewMode('events'); setShowMenu(false); }} className={`block w-full text-left px-4 py-2 hover:bg-gray-100 ${viewMode==='events'?'text-blue-600 bg-blue-50':''}`}>Sự kiện</button>
                                        </div>
                                    )}
                                </div>
                                {renderCenterContent()}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- LỊCH VIEW (THÁNG) ---
        const CalendarView = ({ user, db, appId }) => {
            const [currentDate, setCurrentDate] = useState(new Date());
            const [selectedDate, setSelectedDate] = useState(new Date());
            const [events, setEvents] = useState([]);
            const [showEventModal, setShowEventModal] = useState(false);
            const [animClass, setAnimClass] = useState('');
            const [touchStart, setTouchStart] = useState(null);
            const onTouchStart = (e) => { if(e.touches.length > 1) return; setTouchStart(e.targetTouches[0].clientX); }
            const onTouchEnd = (e) => {
                if (!touchStart || e.changedTouches.length > 1) return;
                const distance = touchStart - e.changedTouches[0].clientX;
                if (distance > 50) { setAnimClass('anim-next'); setTimeout(() => { setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1)); setAnimClass(''); }, 400); }
                if (distance < -50) { setAnimClass('anim-prev'); setTimeout(() => { setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1)); setAnimClass(''); }, 400); }
                setTouchStart(null);
            }
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const startDayIndex = new Date(year, month, 1).getDay() === 0 ? 6 : new Date(year, month, 1).getDay() - 1;
            const days = Array(startDayIndex).fill(null).concat(Array.from({length: daysInMonth}, (_, i) => new Date(year, month, i + 1)));

            const eventsRef = useMemo(() => collection(db, 'artifacts', appId, 'users', user.uid, 'events'), [db, appId, user.uid]);
            useEffect(() => onSnapshot(query(eventsRef), snap => setEvents(snap.docs.map(d => ({id: d.id, ...d.data()})))), [eventsRef]);
            const hasEvent = (date) => {
                if (!date) return false;
                const dateStr = date.toDateString();
                const lunar = getLunarDetails(date);
                return events.some(e => {
                    if (!e.repeat || e.repeat === 'none') return e.date && new Date(e.date.seconds * 1000).toDateString() === dateStr;
                    if (e.repeat === 'lunar') return e.lunarDay === lunar.day && e.lunarMonth === lunar.month;
                    if (e.repeat === 'solar' && e.date) { const d = new Date(e.date.seconds * 1000); return d.getDate() === date.getDate() && d.getMonth() === date.getMonth(); }
                    return false;
                });
            };
            const getEventsForDate = (date) => {
                if (!date) return [];
                const dateStr = date.toDateString();
                const lunar = getLunarDetails(date);
                return events.filter(e => {
                    if (!e.repeat || e.repeat === 'none') return e.date && new Date(e.date.seconds * 1000).toDateString() === dateStr;
                    if (e.repeat === 'lunar') return e.lunarDay === lunar.day && e.lunarMonth === lunar.month;
                    if (e.repeat === 'solar' && e.date) { const d = new Date(e.date.seconds * 1000); return d.getDate() === date.getDate() && d.getMonth() === date.getMonth(); }
                    return false;
                });
            };
            const handleAddEvent = async (title, repeatType) => {
                const data = { title, date: Timestamp.fromDate(selectedDate), repeat: repeatType };
                if (repeatType === 'lunar') { const lunar = getLunarDetails(selectedDate); data.lunarDay = lunar.day; data.lunarMonth = lunar.month; }
                await addDoc(eventsRef, data);
            };
            const getDayColor = (index) => {
                if (index === 5) return 'text-[#84cc16]'; 
                if (index === 6) return 'text-[#ec4899]'; 
                return 'text-[#0000FF]'; 
            };
            return (
                <div className="p-4 select-none perspective-container" onTouchStart={onTouchStart} onTouchEnd={onTouchEnd}>
                    <div className="flex justify-between items-center mb-6 bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                        <button onClick={() => setCurrentDate(new Date(year, month - 1, 1))} className="p-2 hover:bg-gray-100 rounded-full"><ChevronLeft className="text-gray-600" /></button>
                        <h2 className="text-lg font-bold uppercase text-gray-800">Tháng {month + 1} / {year}</h2>
                        <button onClick={() => setCurrentDate(new Date(year, month + 1, 1))} className="p-2 hover:bg-gray-100 rounded-full"><ChevronRight className="text-gray-600" /></button>
                    </div>
                    <div className="grid grid-cols-7 gap-1 text-center mb-2 bg-[#FEF3C7] py-2 rounded-lg shadow-sm border border-amber-200">
                        {['T2','T3','T4','T5','T6','T7','CN'].map((d, i) => <div key={d} className={`text-sm font-bold ${getDayColor(i)}`}>{d}</div>)}
                    </div>
                    <div className={`grid grid-cols-7 gap-1 ${animClass}`}>
                        {days.map((date, idx) => {
                            if(!date) return <div key={idx} className="aspect-square"/>;
                            const isSel = date.toDateString() === selectedDate.toDateString();
                            const isToday = date.toDateString() === new Date().toDateString();
                            const dayOfWeek = date.getDay();
                            let textColor = 'text-gray-800';
                            if (dayOfWeek === 6) textColor = 'text-[#84cc16]'; 
                            if (dayOfWeek === 0) textColor = 'text-[#ec4899]'; 
                            if (isSel) textColor = 'text-white';
                            return (
                                <button key={idx} onClick={() => { setSelectedDate(date); setShowEventModal(true); }} className={`aspect-square flex flex-col items-center justify-center rounded-xl transition-all relative ${isSel ? 'bg-blue-600 shadow-md transform scale-105' : 'bg-white hover:bg-blue-50 border border-gray-100'} ${isToday && !isSel ? 'border-2 border-blue-600' : ''}`}>
                                    <span className={`font-bold ${textColor}`}>{date.getDate()}</span>
                                    <span className={`text-[9px] ${isSel?'text-blue-100':'text-gray-400'}`}>{getLunarDate(date)}</span>
                                    {hasEvent(date) && <div className={`w-1.5 h-1.5 rounded-full mt-0.5 ${isSel ? 'bg-white' : 'bg-red-500'}`}></div>}
                                </button>
                            )
                        })}
                    </div>
                    <div className="mt-6 flex justify-center">
                         <button onClick={() => setShowEventModal(true)} className="bg-blue-600 text-white px-4 py-2 rounded-full shadow-lg flex items-center gap-2 text-sm font-bold active:scale-95 transition-transform"><Plus size={16}/> Thêm sự kiện cho ngày {selectedDate.getDate()}/{selectedDate.getMonth()+1}</button>
                    </div>
                    {showEventModal && <EventModal date={selectedDate} events={getEventsForDate(selectedDate)} onClose={() => setShowEventModal(false)} onAdd={handleAddEvent} onDelete={async (id) => { await deleteDoc(doc(eventsRef, id)); }} />}
                </div>
            );
        };

        const EventModal = ({ date, events, onClose, onAdd, onDelete }) => {
            const [newEvent, setNewEvent] = useState('');
            const [repeatType, setRepeatType] = useState('none'); 
            const [deleteConfirm, setDeleteConfirm] = useState(null);
            const lunar = getLunarDetails(date);
            const handleDelete = (id) => {
                if (deleteConfirm === id) { onDelete(id); setDeleteConfirm(null); } 
                else { setDeleteConfirm(id); setTimeout(() => setDeleteConfirm(null), 3000); }
            };
            return (
                <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4" onClick={(e)=>e.stopPropagation()}>
                    <div className="bg-white w-full max-w-sm rounded-xl shadow-2xl overflow-hidden flex flex-col max-h-[80%]" onClick={(e)=>e.stopPropagation()}>
                        <div className="bg-blue-600 p-4 text-white flex justify-between items-center">
                            <div><h3 className="font-bold">Sự kiện {date.getDate()}/{date.getMonth()+1}</h3><span className="text-xs opacity-80">Âm lịch: {lunar.day}/{lunar.month}</span></div>
                            <button onClick={onClose} className="p-2"><X size={20}/></button>
                        </div>
                        <div className="p-4 overflow-y-auto flex-1">
                            {events.length === 0 && <p className="text-center text-gray-500 py-4">Chưa có sự kiện nào.</p>}
                            <ul className="space-y-2">
                                {events.map(e => (
                                    <li key={e.id} className="flex justify-between items-center bg-blue-50 p-2 rounded text-sm text-gray-800">
                                        <div className="flex items-center gap-2">
                                            {e.repeat === 'lunar' && <span className="text-[10px] bg-purple-100 text-purple-700 px-1 rounded">Âm</span>}
                                            {e.repeat === 'solar' && <span className="text-[10px] bg-orange-100 text-orange-700 px-1 rounded">Dương</span>}
                                            <span>{e.title}</span>
                                        </div>
                                        <button onClick={() => handleDelete(e.id)} className={`transition-all ${deleteConfirm === e.id ? 'text-red-600 font-bold text-xs bg-red-100 px-2 py-1 rounded' : 'text-red-400 hover:text-red-600'}`}>{deleteConfirm === e.id ? 'Xóa?' : <Trash2 size={16}/>}</button>
                                    </li>
                                ))}
                            </ul>
                        </div>
                        <div className="p-4 border-t bg-gray-50 flex flex-col gap-2">
                            <div className="flex gap-2 text-xs mb-1 text-gray-700">
                                <label className="flex items-center gap-1 cursor-pointer"><input type="radio" name="repeat" checked={repeatType === 'none'} onChange={() => setRepeatType('none')} /> Không lặp</label>
                                <label className="flex items-center gap-1 cursor-pointer"><input type="radio" name="repeat" checked={repeatType === 'lunar'} onChange={() => setRepeatType('lunar')} /> Lặp Âm</label>
                                <label className="flex items-center gap-1 cursor-pointer"><input type="radio" name="repeat" checked={repeatType === 'solar'} onChange={() => setRepeatType('solar')} /> Lặp Dương</label>
                            </div>
                            <div className="flex gap-2">
                                <input className="flex-1 border rounded px-3 py-2 text-sm outline-none focus:border-blue-500 text-black" placeholder="Tên sự kiện..." value={newEvent} onChange={e => setNewEvent(e.target.value)} />
                                <button onClick={() => { if(newEvent.trim()) { onAdd(newEvent, repeatType); setNewEvent(''); } }} className="bg-blue-600 text-white p-2 rounded hover:bg-blue-700"><Plus size={20}/></button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const TodoEditor = ({ initialText, initialReminder, initialDeadline, isNew, onSave, onCancel }) => {
            const [text, setText] = useState(initialText || '');
            const [reminder, setReminder] = useState(initialReminder || '');
            const [deadline, setDeadline] = useState(initialDeadline || '');
            return (
                <div className="fixed inset-0 bg-white z-50 flex flex-col animate-in slide-in-from-bottom-5">
                    <div className="flex justify-between items-center p-4 border-b bg-gray-50">
                        <button onClick={onCancel} className="p-2 hover:bg-gray-200 rounded-full"><X size={20}/></button> 
                        <h3 className="font-bold text-gray-700">{isNew ? 'Thêm Việc' : 'Sửa Việc'}</h3>
                        <button onClick={()=>onSave(text, reminder, deadline)} className="text-blue-600 font-bold p-2"><Save size={18}/> Lưu</button>
                    </div>
                    <div className="p-4 flex-1 flex flex-col gap-4">
                        <div><label className="text-xs font-bold text-gray-500 block mb-1">Nội dung</label><input className="w-full text-lg border-b p-2 outline-none focus:border-blue-500" value={text} onChange={e=>setText(e.target.value)} autoFocus /></div>
                        <div><label className="text-xs font-bold text-gray-500 block mb-1 flex items-center gap-1"><AlertCircle size={12}/> Hạn chót (Deadline)</label><input type="datetime-local" className="w-full border rounded p-2 text-sm bg-gray-50" value={deadline} onChange={e=>setDeadline(e.target.value)} /></div>
                        <div><label className="text-xs font-bold text-gray-500 block mb-1 flex items-center gap-1"><Bell size={12}/> Nhắc tôi trước</label><input type="datetime-local" className="w-full border rounded p-2 text-sm bg-gray-50" value={reminder} onChange={e=>setReminder(e.target.value)} /></div>
                    </div>
                </div>
            );
        };

        const TodoView = ({ user, db, appId, theme }) => {
            const [todos, setTodos] = useState([]);
            const [editing, setEditing] = useState(null);
            const [deleteConfirm, setDeleteConfirm] = useState(null);
            const todoRef = useMemo(() => collection(db, 'artifacts', appId, 'users', user.uid, 'todos'), [db, appId, user.uid]);
            useEffect(() => onSnapshot(query(todoRef), snap => {
                const data = snap.docs.map(d => ({id: d.id, ...d.data()}));
                data.sort((a, b) => {
                    if (a.order !== undefined && b.order !== undefined) return a.order - b.order;
                    return (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0);
                });
                setTodos(data);
            }), [todoRef]);
            const save = async (text, reminderStr, deadlineStr) => {
                const reminderData = reminderStr ? Timestamp.fromDate(new Date(reminderStr)) : null;
                const deadlineData = deadlineStr ? Timestamp.fromDate(new Date(deadlineStr)) : null;
                const payload = { text, reminderTime: reminderData, deadlineTime: deadlineData };
                if (editing.id) await updateDoc(doc(todoRef, editing.id), payload);
                else await addDoc(todoRef, { ...payload, completed: false, createdAt: serverTimestamp(), order: Date.now() });
                setEditing(null);
            };
            const handleDelete = (e, id) => {
                e.stopPropagation();
                if (deleteConfirm === id) { deleteDoc(doc(todoRef, id)); setDeleteConfirm(null); } 
                else { setDeleteConfirm(id); setTimeout(() => setDeleteConfirm(null), 3000); }
            };
            const moveItem = async (e, index, direction) => {
                e.stopPropagation();
                if ((direction === -1 && index === 0) || (direction === 1 && index === todos.length - 1)) return;
                const itemA = todos[index];
                const itemB = todos[index + direction];
                const orderA = itemB.order || Date.now();
                const orderB = itemA.order || Date.now();
                await updateDoc(doc(todoRef, itemA.id), { order: orderA });
                await updateDoc(doc(todoRef, itemB.id), { order: orderB });
            };
            const isOverdue = (timestamp) => timestamp && new Date() > new Date(timestamp.seconds * 1000);
            return (
                <div className="p-4 pb-24 min-h-full" style={{ color: theme.textColor }}>
                    <div className="flex justify-between items-center mb-4">
                        <h2 className="text-xl font-bold">Danh sách việc</h2>
                        <button onClick={()=>setEditing({})} className="bg-blue-100 text-blue-600 px-3 py-2 rounded-lg flex items-center gap-1 text-sm font-bold"><Plus size={16}/> Mới</button>
                    </div>
                    <div className="space-y-2">
                        {todos.map((t, idx) => {
                            const timeStatus = t.deadlineTime ? getRemainingTime(t.deadlineTime) : null;
                            return (
                                <div key={t.id} onClick={() => setEditing(t)} className="group flex items-center p-3 bg-white rounded-lg shadow-sm border border-gray-100 cursor-pointer hover:bg-gray-50">
                                    <div className="flex flex-col mr-2 text-gray-300" onClick={e => e.stopPropagation()}>
                                        <button onClick={(e)=>moveItem(e, idx, -1)} className="hover:text-blue-500 p-0.5"><ArrowUp size={14}/></button>
                                        <button onClick={(e)=>moveItem(e, idx, 1)} className="hover:text-blue-500 p-0.5"><ArrowDown size={14}/></button>
                                    </div>
                                    <div className="mt-1 mr-3 cursor-pointer text-gray-400" onClick={(e) => { e.stopPropagation(); updateDoc(doc(todoRef, t.id), {completed: !t.completed}); }}>
                                        {t.completed ? <CheckSquare className="text-green-500"/> : <div className="w-5 h-5 border-2 rounded"></div>}
                                    </div>
                                    <div className="flex-1">
                                        <div className={`font-medium ${t.completed ? 'line-through text-gray-400' : ''}`} style={{color: t.completed ? undefined : theme.textColor}}>{t.text}</div>
                                        <div className="flex gap-3 mt-1 flex-wrap">
                                            {t.deadlineTime && <div className={`text-[10px] flex items-center gap-1 ${timeStatus?.isOverdue && !t.completed ? 'text-red-600 font-bold' : 'text-gray-500'}`}><AlertCircle size={10}/> {t.completed ? `Thời hạn: ${formatDisplayDate(t.deadlineTime.seconds)}` : timeStatus?.text}</div>}
                                            {t.reminderTime && !t.completed && <div className="text-[10px] text-orange-500 flex items-center gap-1"><Bell size={10} /> Nhắc: {formatDisplayDate(t.reminderTime.seconds)}</div>}
                                        </div>
                                    </div>
                                    <button onClick={(e) => handleDelete(e, t.id)} className={`p-1 rounded transition-all ${deleteConfirm === t.id ? 'bg-red-100 text-red-600 w-16 text-xs font-bold' : 'text-gray-300 hover:text-red-500'}`}>{deleteConfirm === t.id ? 'Xóa?' : <Trash2 size={16}/>}</button>
                                </div>
                            );
                        })}
                    </div>
                    {editing && <TodoEditor initialText={editing.text} initialReminder={editing.reminderTime ? formatDateTimeForInput(editing.reminderTime.seconds*1000) : ''} initialDeadline={editing.deadlineTime ? formatDateTimeForInput(editing.deadlineTime.seconds*1000) : ''} isNew={!editing.id} onSave={save} onCancel={() => setEditing(null)} />}
                </div>
            );
        };

        const NoteEditor = ({ initialTitle, initialContent, initialReminder, initialColor, isNew, onSave, onCancel }) => {
            const [title, setTitle] = useState(initialTitle || '');
            const [content, setContent] = useState(initialContent || '');
            const [reminder, setReminder] = useState(initialReminder || '');
            const [color, setColor] = useState(initialColor || '#FEFCE8'); 
            return (
                <div className="fixed inset-0 bg-white z-50 flex flex-col animate-in slide-in-from-bottom-5">
                    <div className="flex justify-between items-center p-4 border-b">
                        <button onClick={onCancel}><X/></button> <button onClick={()=>onSave(title, content, reminder, color)} className="text-blue-600 font-bold"><Save/> Lưu</button>
                    </div>
                    <div className="px-4 py-2 bg-gray-50 flex gap-3 overflow-x-auto no-scrollbar items-center">
                        <span className="text-xs text-gray-500 font-bold mr-1">Màu:</span>
                        {NOTE_COLORS.map(c => (
                            <button key={c} onClick={() => setColor(c)} className={`w-8 h-8 rounded-full border border-gray-300 shadow-sm transition-transform hover:scale-110 ${color === c ? 'ring-2 ring-blue-500 ring-offset-2' : ''}`} style={{ backgroundColor: c }} />
                        ))}
                    </div>
                    <div className="px-4 py-2 bg-gray-50 border-b flex items-center gap-2">
                        <Bell size={16} className="text-gray-500"/>
                        <span className="text-xs text-gray-600 font-medium">Nhắc tôi vào:</span>
                        <input type="datetime-local" className="bg-white border rounded px-2 py-1 text-xs text-gray-700 outline-none" value={reminder} onChange={e=>setReminder(e.target.value)} />
                    </div>
                    <div className="p-4 flex-1 flex flex-col gap-4" style={{ backgroundColor: color }}>
                        <input className="text-2xl font-bold outline-none placeholder-gray-400 bg-transparent" placeholder="Tiêu đề" value={title} onChange={e=>setTitle(e.target.value)} />
                        <textarea className="flex-1 resize-none outline-none text-gray-700 leading-relaxed placeholder-gray-400 bg-transparent" placeholder="Nội dung..." value={content} onChange={e=>setContent(e.target.value)} />
                    </div>
                </div>
            );
        };

        const NotesView = ({ user, db, appId, theme }) => {
            const [notes, setNotes] = useState([]);
            const [editing, setEditing] = useState(null);
            const [deleteConfirm, setDeleteConfirm] = useState(null);
            const noteRef = useMemo(() => collection(db, 'artifacts', appId, 'users', user.uid, 'notes'), [db, appId, user.uid]);
            useEffect(() => onSnapshot(query(noteRef), snap => setNotes(snap.docs.map(d => ({id: d.id, ...d.data()})).sort((a,b) => (b.updatedAt?.seconds||0) - (a.updatedAt?.seconds||0)))), [noteRef]);
            const save = (title, content, reminderStr, color) => {
                const reminderData = reminderStr ? Timestamp.fromDate(new Date(reminderStr)) : null;
                const data = { title: title||'K.Tiêu đề', content: content||'', reminderTime: reminderData, color: color, updatedAt: serverTimestamp() };
                if(editing.id) updateDoc(doc(noteRef, editing.id), data);
                else addDoc(noteRef, data);
                setEditing(null);
            };
            const handleDelete = (e, id) => {
                e.stopPropagation();
                if (deleteConfirm === id) { deleteDoc(doc(noteRef, id)); setDeleteConfirm(null); } 
                else { setDeleteConfirm(id); setTimeout(() => setDeleteConfirm(null), 3000); }
            };
            if (editing) {
                const currentReminderStr = editing.reminderTime ? formatDateTimeForInput(editing.reminderTime.seconds * 1000) : '';
                return <NoteEditor initialTitle={editing.title} initialContent={editing.content} initialReminder={currentReminderStr} initialColor={editing.color} isNew={!editing.id} onSave={save} onCancel={() => setEditing(null)} />;
            }
            return (
                <div className="p-4" style={{color: theme.textColor}}>
                    <div className="flex justify-between mb-4"><h2 className="text-xl font-bold">Sổ tay</h2><button onClick={()=>setEditing({})} className="bg-blue-100 text-blue-600 px-3 py-2 rounded-lg flex items-center gap-1 text-sm font-bold"><Plus size={16}/> Mới</button></div>
                    <div className="grid grid-cols-2 gap-3">
                        {notes.map(n => (
                            <div key={n.id} onClick={()=>setEditing(n)} className="p-4 rounded-xl border shadow-sm h-48 flex flex-col relative" style={{backgroundColor: n.color || theme.noteColor, borderColor: '#e5e7eb'}}>
                                <div className="flex justify-between items-start mb-2"><h4 className="font-bold truncate text-gray-800 flex-1">{n.title}</h4>{n.reminderTime && <Bell size={12} className="text-orange-500 mt-1 ml-1" />}</div>
                                <p className="text-xs opacity-80 overflow-hidden flex-1 leading-relaxed whitespace-pre-wrap text-gray-800">{n.content}</p>
                                {n.reminderTime && <div className="text-[9px] text-orange-600 font-medium mt-1 mb-1 flex items-center gap-1"><Clock size={10}/> {formatDisplayDate(n.reminderTime.seconds)}</div>}
                                <div className="flex justify-between items-center mt-1 pt-2 border-t border-black/10">
                                    <span className="text-[10px] opacity-60 text-gray-600">{n.updatedAt ? new Date(n.updatedAt.seconds*1000).toLocaleDateString('vi-VN') : ''}</span>
                                    <button onClick={(e)=>handleDelete(e, n.id)} className={`transition-all ${deleteConfirm === n.id ? 'bg-white text-red-600 px-2 py-1 rounded shadow-sm text-xs font-bold' : 'opacity-40 hover:opacity-100 hover:text-red-500'}`}>{deleteConfirm === n.id ? 'Xóa?' : <Trash2 size={16}/>}</button>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [activeTab, setActiveTab] = useState('calendar');
            const [app, setApp] = useState(null);
            const [showSettings, setShowSettings] = useState(false);
            const [showMenu, setShowMenu] = useState(false);
            const [connectionError, setConnectionError] = useState('');
            
            const [theme, setTheme] = useState(() => {
                try { return JSON.parse(localStorage.getItem('app_theme')) || { bgColor: '#f3f4f6', noteColor: '#FEFCE8', textColor: '#1F2937' }; } 
                catch(e) { return { bgColor: '#f3f4f6', noteColor: '#FEFCE8', textColor: '#1F2937' }; }
            });

            useEffect(() => {
                const init = async () => {
                    try {
                        const newApp = initializeApp(MANUAL_CONFIG);
                        setApp(newApp);
                        const auth = getAuth(newApp);
                        const db = getFirestore(newApp);
                        
                        if ('Notification' in window && Notification.permission !== 'granted') Notification.requestPermission();
                        setInterval(() => checkNotification(db, auth.currentUser?.uid), 60000); 

                        onAuthStateChanged(auth, async (u) => {
                            setUser(u);
                            if (u) {
                                const docSnap = await getDoc(doc(db, 'artifacts', MANUAL_CONFIG.projectId, 'users', u.uid, 'settings', 'theme'));
                                if (docSnap.exists()) setTheme(docSnap.data());
                                checkDailyEvents(db, u.uid);
                            }
                            setLoading(false);
                        });
                        setConnectionError('');
                    } catch (e) {
                        setConnectionError("Lỗi kết nối Server.");
                    }
                };
                init();
            }, []);

            const checkNotification = async (db, uid) => {
                if (!uid) return;
                const now = new Date();
                if (now.getHours() === 5 && now.getMinutes() === 0) checkDailyEvents(db, uid);
            };

            const checkDailyEvents = async (db, uid) => {
                const eventsRef = collection(db, 'artifacts', MANUAL_CONFIG.projectId, 'users', uid, 'events');
                const today = new Date();
                const todayStr = today.toDateString();
                const lastCheck = localStorage.getItem('last_event_check');
                
                onSnapshot(query(eventsRef), snap => {
                    const events = snap.docs.map(d => d.data());
                    const lunar = getLunarDetails(today);
                    events.forEach(e => {
                        let isToday = false;
                        if (!e.repeat || e.repeat === 'none') isToday = e.date && new Date(e.date.seconds*1000).toDateString() === todayStr;
                        else if (e.repeat === 'lunar') isToday = e.lunarDay === lunar.day && e.lunarMonth === lunar.month;
                        else if (e.repeat === 'solar' && e.date) {
                            const d = new Date(e.date.seconds*1000);
                            isToday = d.getDate() === today.getDate() && d.getMonth() === today.getMonth();
                        }
                        if (isToday) sendNotification("📅 Nhắc Lịch Hôm Nay", e.title);
                    });
                    localStorage.setItem('last_event_check', todayStr);
                });
            };

            const handleSaveTheme = async (newTheme) => {
                setTheme(newTheme);
                setShowSettings(false);
                if (user) await setDoc(doc(getFirestore(app), 'artifacts', MANUAL_CONFIG.projectId, 'users', user.uid, 'settings', 'theme'), newTheme);
            };

            if (loading) return <div className="h-screen flex items-center justify-center text-blue-500">Đang tải...</div>;
            if (!user) return <AuthScreen auth={getAuth(app)} appId={MANUAL_CONFIG.projectId} />;

            return (
                <div className="flex flex-col h-screen max-w-md mx-auto shadow-2xl overflow-hidden relative transition-colors duration-300" style={{ backgroundColor: theme.bgColor }}>
                    <header className="bg-blue-600 text-white p-2 flex justify-between items-center shadow-md z-20">
                        <div className="flex flex-col overflow-hidden">
                            <h1 className="text-lg font-bold whitespace-nowrap truncate">Lịch vạn niên đa năng</h1>
                            <span className="text-[10px] text-blue-100 opacity-80 text-center w-full block">Thiết kế bởi Văn Trung</span>
                        </div>
                        <div className="flex gap-2">
                            <button onClick={() => setShowSettings(true)}><Settings size={20} /></button>
                            <button onClick={() => signOut(getAuth(app))}><LogOut size={20} /></button>
                        </div>
                    </header>

                    <main className="flex-1 overflow-y-auto relative flex flex-col">
                        <div style={{ display: activeTab === 'day' ? 'flex' : 'none', flex: 1, flexDirection: 'column' }}><DailyView user={user} db={getFirestore(app)} appId={MANUAL_CONFIG.projectId} /></div>
                        <div style={{ display: activeTab === 'calendar' ? 'block' : 'none' }}><CalendarView user={user} db={getFirestore(app)} appId={MANUAL_CONFIG.projectId} /></div>
                        <div style={{ display: activeTab === 'todo' ? 'block' : 'none', height: '100%' }}><TodoView user={user} db={getFirestore(app)} appId={MANUAL_CONFIG.projectId} theme={theme} /></div>
                        <div style={{ display: activeTab === 'notes' ? 'block' : 'none', height: '100%' }}><NotesView user={user} db={getFirestore(app)} appId={MANUAL_CONFIG.projectId} theme={theme} /></div>
                        <div style={{ display: activeTab === 'timetable' ? 'flex' : 'none', flex: 1, flexDirection: 'column' }}><TimeTableView user={user} db={getFirestore(app)} appId={MANUAL_CONFIG.projectId} theme={theme} /></div>
                    </main>

                    <nav className="w-full bg-white border-t flex justify-around py-3 shadow-lg z-20 relative shrink-0">
                        <button onClick={()=>setActiveTab('day')} className={activeTab==='day'?'text-blue-600':'text-gray-400'}><div className="flex flex-col items-center"><CalendarDays size={24}/><span className="text-[10px]">Hôm Nay</span></div></button>
                        <button onClick={()=>setActiveTab('calendar')} className={activeTab==='calendar'?'text-blue-600':'text-gray-400'}><div className="flex flex-col items-center"><Calendar size={24}/><span className="text-[10px]">Lịch</span></div></button>
                        <button onClick={()=>setActiveTab('todo')} className={activeTab==='todo'?'text-blue-600':'text-gray-400'}><div className="flex flex-col items-center"><CheckSquare size={24}/><span className="text-[10px]">Việc làm</span></div></button>
                        <button onClick={()=>setActiveTab('notes')} className={activeTab==='notes'?'text-blue-600':'text-gray-400'}><div className="flex flex-col items-center"><StickyNote size={24}/><span className="text-[10px]">Ghi chú</span></div></button>
                        
                        {/* Nút 3 Chấm (Thêm) */}
                        <div className="relative">
                            <button onClick={()=>setShowMenu(!showMenu)} className={`text-gray-400 ${showMenu ? 'text-blue-600' : ''}`}><div className="flex flex-col items-center"><MoreVertical size={24}/><span className="text-[10px]">Thêm</span></div></button>
                            {showMenu && (
                                <div className="absolute bottom-12 right-0 bg-white shadow-xl rounded-lg border w-40 overflow-hidden fade-in z-50">
                                    <button onClick={()=>{setActiveTab('timetable'); setShowMenu(false);}} className="flex items-center gap-2 w-full px-4 py-3 hover:bg-gray-50 text-sm text-gray-700 text-left">
                                        <Table size={16}/> Thời Khóa Biểu
                                    </button>
                                </div>
                            )}
                        </div>
                    </nav>

                    {showSettings && <SettingsModal theme={theme} onSave={handleSaveTheme} onClose={()=>setShowSettings(false)} />}
                    {connectionError && (
                        <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
                            <div className="bg-white p-6 rounded-lg shadow-xl text-center">
                                <WifiOff size={48} className="text-red-500 mx-auto mb-2" />
                                <h3 className="font-bold">Mất Kết Nối</h3>
                                <p className="text-sm text-gray-600 mb-4">Vui lòng kiểm tra mạng.</p>
                                <button onClick={()=>window.location.reload()} className="bg-blue-600 text-white px-4 py-2 rounded">Thử Lại</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
<link rel="manifest" href="manifest.json">

<script>
  // Kiểm tra xem trình duyệt có hỗ trợ Service Worker không
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/sw.js')
      .then(reg => console.log('PWA Xuân Lai đã kích hoạt!', reg))
      .catch(err => console.log('Lỗi cài đặt PWA:', err));
    });
  }
</script>
</body>
</html>